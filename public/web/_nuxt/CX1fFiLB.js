const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./sPlvVV00.js","./-aacq5Xj.js","./BMWUekhH.js","./B19A1O9i.js","./DNZiHWQV.js","./zPUvkbEL.js","./BNqXk1Oe.js","./b-_TUx9i.js","./B22A-h4k.js","./Cfcu-t3n.js","./DK1-6_6O.js","./CstU5cVH.js","./BT1VXOqk.js","./CP4Zo7YT.js","./XpsTG8vq.js","./CChenI34.js","./BvugyUor.js","./CRlK2fI5.js","./DodGX9aM.js","./BWWuJQeZ.js","./DN9ov8OT.js","./9bDOsXij.js","./pUN2d83w.js","./Cpt2kRVT.js","./8-c-A7PB.js","./iHyFjswr.js","./DDkKkiq3.js","./BHGRVy27.js","./DOrQ1Prn.js","./BBNTTFau.js","./xli8Y-dU.js","./BaddN8Qc.js","./kRIii9yh.js","./BwjX1SxC.js","./C6Y-ieo6.js","./DaNf1Wdt.js","./CKXZhss7.js","./Bub1HYiY.js","./DqVgEjI6.js","./BYPFJRDI.js","./-p_U-LXi.js","./Cgx-pZ0i.js","./CjnkMdLn.js","./CiUQoDoU.js","./B0y4mbyn.js","./BaNg8fjw.js","./DlAUqK2U.js","./CWtbjjIF.js","./UqhBTNL6.js","./eHMaq9Vz.js","./Bc7ldEoJ.js","./BUyfW8JT.js","./DaWZu8wl.js","./BIwjuh_U.js","./B1HSHvm5.js","./c7oTEPhi.js","./BDlCZ4QK.js","./k3ubpm2k.js","./COzfqa7N.js","./BeKngIBX.js","./C4uzn2yC.js","./D1W4wt5r.js","./V2g0uEJH.js","./CKTa8Hyi.js"])))=>i.map(i=>d[i]);
import{d as ee,Q as te,s as I,w as J,aS as be,j as P,o as f,k as E,r as ye,l as s,z as ae,c as x,n as R,_ as oe,p as o,t as A,m as d,A as K,F as le,B as se,q as we,R as T,U as V,aq as ke,b as $e,a1 as Se,f as W,g as ze,i as Ce,v as M}from"#entry";import ne from"./-aacq5Xj.js";import{_ as Ae}from"./BBNTTFau.js";import{_ as xe}from"./xli8Y-dU.js";import{a as Te}from"./CChenI34.js";import{_ as Ve}from"./DjV6S4bm.js";import{_ as Ie}from"./DodGX9aM.js";import{_ as Ue}from"./EL_6giR3.js";import{_ as De}from"./Qjq6OWkd.js";import{x as X,b as Pe,a as Ee,y as Y,z as Re,A as Be,B as Le}from"./CWtbjjIF.js";import{u as Z}from"./BvugyUor.js";import"./BaddN8Qc.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./BwjX1SxC.js";import"./Cfcu-t3n.js";import"./C6Y-ieo6.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./B22A-h4k.js";import"./Bub1HYiY.js";import"./DN9ov8OT.js";import"./BstbYvQo.js";import"./BWWuJQeZ.js";import"./9bDOsXij.js";import"./iHyFjswr.js";import"./DDkKkiq3.js";import"./BT1VXOqk.js";import"./Dn8X9Gvz.js";import"./DlAUqK2U.js";const Me={key:0,class:"text-sm"},Oe={key:1,class:"text-dimmed flex-none text-sm"},je={class:"flex flex-col gap-2 p-2"},Fe={key:0,class:"flex flex-col gap-1"},Ne={key:1,class:"flex h-30 flex-col items-center justify-center gap-2"},qe={class:"text-muted text-sm"},Ge=ee({__name:"tag-select",props:{modelValue:{default:()=>[]},type:{default:"app"}},emits:["update:modelValue","change","close"],setup(Q,{emit:O}){const j=T(()=>V(()=>import("./sPlvVV00.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)),U=O,B=Q,y=be(B,"modelValue",U),F=te(),g=I([]),c=I([]),$=I(""),a=I(!1),h=async()=>{const i=await Te({type:B.type});g.value=i,l()},S=i=>{c.value.includes(i)?c.value=c.value.filter(_=>_.id!==i.id):c.value.push(i),y.value=c.value.map(_=>_.id),U("change",i)},m=async()=>{await F.create(j).open({type:B.type}).result,await h()},l=()=>{if(!g.value?.length){c.value=[];return}c.value=g.value.filter(i=>y.value?.includes(i.id))},z=()=>{y.value=[],c.value=[],U("change",[])};return J(()=>y.value,()=>{l()},{deep:!1}),J(a,i=>{i?h():U("close")}),(i,_)=>{const D=oe,C=ae,N=ne,q=Ae,L=xe;return f(),P(L,{open:o(a),"onUpdate:open":_[1]||(_[1]=w=>K(a)?a.value=w:null),content:{align:"center",side:"bottom",sideOffset:8}},{content:E(()=>[d("div",je,[s(N,{modelValue:o($),"onUpdate:modelValue":_[0]||(_[0]=w=>K($)?$.value=w:null),placeholder:i.$t("common.search"),clearable:"",icon:"i-lucide-search",variant:"soft",color:"neutral",ui:{root:"w-full",base:"w-full",trailing:"pr-1"}},null,8,["modelValue","placeholder"]),d("div",null,[o(g).length>0?(f(),x("div",Fe,[(f(!0),x(le,null,se(o(g),w=>(f(),P(C,{key:w.id,color:"neutral",variant:"ghost",ui:{base:"justify-between"},onClick:v=>S(w)},{default:E(()=>[we(A(w.name)+" ",1),o(y).includes(w.id)?(f(),P(D,{key:0,name:"i-lucide-check",class:"size-4"})):R("",!0)]),_:2},1032,["onClick"]))),128))])):R("",!0),o(g).length===0?(f(),x("div",Ne,[s(D,{name:"i-lucide-tags",class:"size-5"}),d("span",qe,A(i.$t("common.tag.noTags")),1)])):R("",!0)]),s(q,{type:"dashed"}),d("div",null,[s(C,{label:i.$t("common.tag.manageTags"),color:"neutral",variant:"ghost",icon:"i-lucide-tags",ui:{base:"w-full"},onClick:m},null,8,["label"])])])]),default:E(()=>[ye(i.$slots,"trigger",{},()=>[s(C,{color:"neutral",variant:"outline",ui:{base:"gap-2"}},{default:E(()=>[s(D,{name:"i-lucide-tag",class:"size-4"}),o(y).length>0?(f(),x("span",Me,A(o(y).length)+A(i.$t("common.tag.tags")),1)):(f(),x("span",Oe,A(i.$t("common.tag.allTags")),1)),o(y).length>0?(f(),P(C,{key:2,color:"neutral",variant:"soft",icon:"i-lucide-x",size:"xs",onClick:z})):R("",!0),s(D,{name:"i-lucide-chevron-down",class:"text-dimmed size-4 shrink-0"})]),_:1})])]),_:3},8,["open"])}}}),Qe={class:"flex w-full flex-col items-center justify-center"},He={class:"bg-background sticky top-0 z-10 flex w-full flex-wrap justify-between gap-4 pb-2"},Je={class:"flex items-center gap-4"},Ke={key:0,class:"bg-muted/50 mb-2 flex w-full items-center gap-2 rounded-lg p-2"},We={class:"text-sm font-medium"},Xe={class:"grid grid-cols-1 gap-6 pt-2 pb-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Ye={class:"group-hover:text-primary text-foreground mb-3 flex items-center gap-3"},Ze={class:"border-default flex size-10 flex-none items-center justify-center rounded-lg border border-dashed"},et={class:"truncate text-sm font-medium"},tt={class:"text-muted-foreground mb-6 pr-8 text-xs"},at={class:"line-clamp-2 overflow-hidden"},ot={class:"flex items-center gap-2"},Bt=ee({__name:"list",setup(Q){const O=T(()=>V(()=>import("./CRlK2fI5.js"),__vite__mapDeps([17,18,2,19,20,21,8,22,23,24,25,26,3,27,28,1,29,30,31,32,33,9,34,7,35,36,37,15,38]),import.meta.url)),j=T(()=>V(()=>import("./BYPFJRDI.js"),__vite__mapDeps([39,40,2,26,20,25,41,1,42,43,4,5,6,7,8,9,10,11,12,13,14,44,45,46,47,48]),import.meta.url)),U=T(()=>V(()=>import("./eHMaq9Vz.js"),__vite__mapDeps([49,2,41,26,44,1,45,46,42,50,4,5,6,7,8,9,10,11,12,13,14,47,51,52,53,38]),import.meta.url)),B=T(()=>V(()=>import("./B1HSHvm5.js"),__vite__mapDeps([54,2,1,3,55,11,6,7,8,9,56,47,46]),import.meta.url)),y=T(()=>V(()=>import("./k3ubpm2k.js"),__vite__mapDeps([57,58,2,24,8,23,22,21,3,44,1,45,46,41,26,4,5,6,7,9,10,11,12,13,14,47]),import.meta.url)),F=T(()=>V(()=>import("./BeKngIBX.js"),__vite__mapDeps([59,1,2,60,61,33,8,7,62,63,24,20,32,36,22,25,9,3,4,5,6,10,11,12,13,14,47]),import.meta.url)),g=ke(),{t:c}=$e(),$=te(),a=Se({keyword:"",page:1,pageSize:15,tagIds:[],isPublic:void 0}),h=I(!1),S=I(!0),m=I([]),l=W(new Set),z=W(!1),i=ze(()=>m.value.length>0&&m.value.every(e=>l.value.has(e.id))),_=e=>{if(e===!0){const t=new Set(l.value);m.value.forEach(n=>t.add(n.id)),l.value=t}else l.value=new Set},D=e=>{const t=new Set(l.value);t.has(e.id)?t.delete(e.id):t.add(e.id),l.value=t},C=()=>{l.value=new Set,z.value=!1},N=()=>{z.value=!z.value,z.value||(l.value=new Set)},q=async()=>{if(l.value.size!==0)try{await Z({title:c("console-common.batchDelete"),description:c("ai-agent.backend.desc.delete"),color:"error"});const e=Array.from(l.value),t=[...m.value];m.value=m.value.filter(n=>!l.value.has(n.id)),C(),g.success(c("common.message.deleteSuccess"));try{await Promise.all(e.map(n=>X(n))),m.value.length<5&&S.value&&await v()}catch(n){console.error("Batch delete failed:",n),m.value=t,g.error(c("common.message.deleteFailed"))}}catch{}},L=async e=>{if(l.value.size===0)return;const t=Array.from(l.value),n=t.map(p=>{const u=m.value.find(r=>r.id===p);return{id:p,isPublic:u?.isPublic}});t.forEach(p=>{const u=m.value.find(r=>r.id===p);u&&(u.isPublic=e)}),C(),g.success(c("common.message.updateSuccess"));try{await Promise.all(t.map(p=>Pe(p,{isPublic:e})))}catch(p){console.error("Batch set public failed:",p),n.forEach(({id:u,isPublic:r})=>{const k=m.value.find(G=>G.id===u);k&&(k.isPublic=r)}),g.error(c("common.message.updateFailed"))}},w=async()=>{if(l.value.size===0)return;const e=Array.from(l.value);C(),g.success(c("common.message.updateSuccess"));try{await Promise.all(e.map(async t=>{try{await Ee(t)}catch(n){console.warn(`Failed to sync agent ${t}`,n)}})),await v()}catch(t){console.error("Batch sync coze failed:",t)}},v=async()=>{if(!h.value){h.value=!0,a.page=1;try{const e=await Y(a);m.value=e.items||[],S.value=e.totalPages>a.page}catch(e){console.error("获取数据失败:",e),S.value=!1}finally{h.value=!1}}},ie=async()=>{if(!(h.value||!S.value)){h.value=!0,a.page!==void 0&&a.page++;try{const e=await Y(a);e.items&&e.items.length>0?(m.value.push(...e.items),S.value=e.totalPages>(a.page||0)):S.value=!1}catch(e){a.page!==void 0&&a.page--,console.error("加载更多数据失败:",e)}finally{h.value=!1}}},re=async e=>{try{await Z({title:c("console-common.delete"),description:c("ai-agent.backend.desc.delete"),color:"error"}),await X(e.id);const t=a.page;a.page=1,a.pageSize=m.value.length,await v(),a.page=t,a.pageSize=15,g.success(c("common.message.deleteSuccess"))}catch(t){console.error("删除失败:",t)}},H=async(e=null)=>{await $.create(U).open({id:e}).result&&(a.page=1,a.pageSize=15,await v())},ce=async()=>{const e=$.create(B);await e.open().result&&(a.page=1,a.pageSize=15,await v()),e.open()},de=e=>{H(e.id)},ue=()=>{H(null)},me=async e=>{try{const t=await Re(e.id,"yaml"),n=new Blob([t],{type:"text/yaml;charset=utf-8"}),p=URL.createObjectURL(n),u=document.createElement("a");u.href=p,u.download=`${e.name||"agent"}.yaml`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),g.success("DSL 文件导出成功！")}catch(t){console.error("导出 DSL 失败:",t)}},pe=async()=>{await $.create(y).open().result&&(a.page=1,a.pageSize=15,await v())},ge=async()=>{await $.create(F).open().result&&(a.page=1,a.pageSize=15,h.value=!1,await v())},fe=async(e,t)=>{const n=e.tags?.map(k=>k.id)??[],p=t,u=p.filter(k=>!n.includes(k)),r=n.filter(k=>!p.includes(k));u.length===0&&r.length===0||(u.length>0&&await Be(e.id,u),r.length>0&&await Le(e.id,r),await v())},ve=async()=>{$.create(j).open()};return Ce(()=>v()),(e,t)=>{const n=ne,p=Ge,u=Ve,r=ae,k=Ie,G=oe,he=Ue,_e=De;return f(),x("div",Qe,[d("div",He,[d("div",Je,[s(n,{modelValue:o(a).keyword,"onUpdate:modelValue":t[0]||(t[0]=b=>o(a).keyword=b),placeholder:e.$t("ai-agent.backend.search.placeholder"),class:"w-80",onChange:v},null,8,["modelValue","placeholder"]),s(p,{modelValue:o(a).tagIds,"onUpdate:modelValue":t[1]||(t[1]=b=>o(a).tagIds=b),onChange:v},null,8,["modelValue"]),s(u,{modelValue:o(a).isPublic,"onUpdate:modelValue":t[2]||(t[2]=b=>o(a).isPublic=b),items:[{label:e.$t("ai-agent.backend.search.allStatus"),value:void 0},{label:e.$t("ai-agent.backend.configuration.public"),value:!0},{label:e.$t("ai-agent.backend.configuration.private"),value:!1}],placeholder:e.$t("ai-agent.backend.search.filterByStatus"),"label-key":"label","value-key":"value",class:"w-48",onChange:v},null,8,["modelValue","items","placeholder"])]),d("div",null,[o(z)?R("",!0):(f(),P(r,{key:0,color:"neutral",variant:"ghost",icon:"i-lucide-list-checks",label:e.$t("console-common.batchOperation"),onClick:N},null,8,["label"])),s(r,{color:"primary",variant:"ghost",icon:"i-lucide-package",label:e.$t("decorate.openDecorateSettings"),onClick:M(ve,["stop"])},null,8,["label"])])]),o(z)?(f(),x("div",Ke,[s(k,{"model-value":o(i),label:"全选","onUpdate:modelValue":_},null,8,["model-value"]),t[5]||(t[5]=d("div",{class:"h-4 w-px bg-gray-300 dark:bg-gray-700"},null,-1)),d("span",We,A(o(l).size)+" "+A(e.$t("console-common.selected")),1),t[6]||(t[6]=d("div",{class:"h-4 w-px bg-gray-300 dark:bg-gray-700"},null,-1)),s(r,{color:"error",variant:"ghost",icon:"i-lucide-trash",size:"xs",label:e.$t("console-common.batchDelete"),disabled:o(l).size===0,onClick:q},null,8,["label","disabled"]),s(r,{color:"primary",variant:"ghost",icon:"i-lucide-globe",size:"xs",label:e.$t("ai-agent.backend.configuration.public"),disabled:o(l).size===0,onClick:t[3]||(t[3]=b=>L(!0))},null,8,["label","disabled"]),s(r,{color:"neutral",variant:"ghost",icon:"i-lucide-globe-lock",size:"xs",label:e.$t("ai-agent.backend.configuration.private"),disabled:o(l).size===0,onClick:t[4]||(t[4]=b=>L(!1))},null,8,["label","disabled"]),s(r,{color:"info",variant:"ghost",icon:"i-lucide-refresh-cw",size:"xs",label:"批量更新Coze",disabled:o(l).size===0,onClick:w},null,8,["disabled"]),t[7]||(t[7]=d("div",{class:"flex-1"},null,-1)),s(r,{color:"neutral",variant:"ghost",icon:"i-lucide-x",size:"xs",label:e.$t("console-common.cancel"),onClick:C},null,8,["label"])])):R("",!0),s(_e,{class:"h-[calc(100vh-9rem)] min-h-0 w-full"},{default:E(()=>[s(he,{loading:o(h),"has-more":o(S),threshold:200,"loading-text":e.$t("common.loading"),"no-more-text":o(a).page!==1?e.$t("common.noMoreData"):" ",onLoadMore:ie},{default:E(()=>[d("div",Xe,[d("div",{class:"group border-default relative cursor-pointer rounded-lg border border-dashed p-4 transition-all duration-200 hover:shadow-lg",onClick:ue},[d("div",Ye,[d("div",Ze,[s(G,{name:"i-lucide-plus",class:"h-6 w-6"})]),d("h3",et,A(e.$t("ai-agent.backend.create.title")),1)]),d("div",tt,[d("p",at,A(e.$t("ai-agent.backend.create.desc")),1)]),d("div",ot,[s(r,{color:"primary",variant:"ghost",class:"w-full",icon:"i-lucide-package",size:"sm",label:e.$t("ai-agent.backend.create.fromTemplate"),onClick:M(ce,["stop"])},null,8,["label"]),s(r,{color:"neutral",variant:"ghost",class:"w-full",icon:"i-lucide-file-up",size:"sm",label:e.$t("ai-agent.backend.dslImport.import"),onClick:M(pe,["stop"])},null,8,["label"]),s(r,{color:"neutral",variant:"ghost",class:"w-full",icon:"i-lucide-bot",size:"sm",label:"从Coze导入",onClick:M(ge,["stop"])})])]),(f(!0),x(le,null,se(o(m),b=>(f(),P(o(O),{key:b.id,agent:b,selected:o(l).has(b.id),"selection-mode":o(z),onDelete:re,onEdit:de,onExportDsl:me,onUpdateTags:fe,onToggleSelect:D},null,8,["agent","selected","selection-mode"]))),128))])]),_:1},8,["loading","has-more","loading-text","no-more-text"])]),_:1})])}}});export{Bt as default};

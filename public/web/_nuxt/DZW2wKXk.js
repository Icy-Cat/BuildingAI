const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D7r3MFL-.js","./BMWUekhH.js","./CjnkMdLn.js","./Cgx-pZ0i.js","./DDkKkiq3.js","./DOkYLxiv.js","./BvrbnHlJ.js","./BaddN8Qc.js","./8-c-A7PB.js","./kRIii9yh.js","./BwjX1SxC.js","./Cfcu-t3n.js","./C6Y-ieo6.js","./b-_TUx9i.js","./DaNf1Wdt.js","./CKXZhss7.js","./Cpt2kRVT.js","./pUN2d83w.js","./B22A-h4k.js","./Bub1HYiY.js","./Bpk8zbrs.js","./XpsTG8vq.js","./DAB2a9hE.js","./BMSQkwth.js","./DaWZu8wl.js","./8nwS_hHr.js","./-p_U-LXi.js","./DN9ov8OT.js","./iHyFjswr.js","./Bc7ldEoJ.js","./DNZiHWQV.js","./zPUvkbEL.js","./BNqXk1Oe.js","./DK1-6_6O.js","./CstU5cVH.js","./BT1VXOqk.js","./CP4Zo7YT.js","./CWtbjjIF.js","./DTJhkpWV.js","./BUyfW8JT.js","./BsZHeQ4I.js","./Qjq6OWkd.js","./Dn8X9Gvz.js","./DlAUqK2U.js","./D7byCJqG.js","./-aacq5Xj.js","./DjV6S4bm.js","./BstbYvQo.js"])))=>i.map(i=>d[i]);
import{d as Ve,b as Ae,aq as Ee,b9 as Ue,s as B,i as De,G as le,w as te,aZ as X,a_ as ee,g as R,aS as st,j as M,o as n,b7 as nt,k as p,m as a,l as c,T as Ce,c as m,n as _,p as e,C as ot,t as x,z as Be,_ as Re,q as Le,F as T,B as A,v as $e,x as ae,A as ie,f as lt,aT as it,h as ge,aL as ye,aJ as rt,au as ct,Q as ut,e as dt,aN as mt,O as Te,a1 as ft,ap as pt,bF as Se,ah as vt,aV as ht,D as gt,R as _e,E as _t,bs as xt,U as xe}from"#entry";import{_ as yt}from"./_1k1KbFY.js";import{_ as kt,a as bt}from"./B564akus.js";import{_ as wt}from"./BBNTTFau.js";import{_ as Ct}from"./BIVu-AGc.js";import{_ as je}from"./Qjq6OWkd.js";import{_ as $t}from"./DILziS8N.js";import{g as Tt,h as St,i as Ft,j as zt,k as Fe,l as Mt,m as It}from"./DTJhkpWV.js";import{e as Vt}from"./B1XcE43x.js";import{e as ze}from"./Bni8bPEl.js";import At from"./-aacq5Xj.js";import{_ as Et}from"./Cgx-pZ0i.js";import{_ as Ut}from"./BvrbnHlJ.js";import{_ as Dt}from"./C8CK8nAU.js";import{_ as Bt}from"./BQnzPqK6.js";import{g as Rt}from"./eeyg4-1U.js";import{u as Me}from"./BvugyUor.js";import{d as Lt}from"./CP4Zo7YT.js";import{_ as jt}from"./DlAUqK2U.js";import{u as Ie}from"./BI1JbAYD.js";import{u as qt}from"./DqNHTeRY.js";const Nt={class:"relative h-full flex-1"},Ot={key:0,class:"flex h-full min-h-0 w-[240px] flex-col"},Pt={class:"border-border/50 border-b p-4"},Gt={class:"flex items-center gap-3"},Qt={class:"min-w-0 flex-1"},Ht={class:"truncate font-medium"},Kt={class:"h-full flex-1 overflow-hidden"},Jt={key:0,class:"text-muted-foreground flex h-full flex-col items-center justify-center text-center text-sm"},Yt={class:"mb-2"},Zt={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},Wt={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},Xt={class:"flex flex-col gap-1"},ea={class:"block flex-1 truncate text-left"},ta={key:0,class:"flex flex-col gap-4 py-4"},aa={class:"px-2 py-1"},sa={class:"flex flex-col gap-1"},na={key:0,class:"bg-background absolute top-0 left-0 z-50 flex h-12 items-center gap-2 rounded-tl-xl px-4"},oa={class:"truncate text-lg font-semibold"},la={key:0,class:"text-muted-foreground flex h-full w-50 flex-col items-center justify-center text-center text-sm"},ia={class:"mb-2"},ra={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},ca={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},ua={class:"flex flex-col gap-1"},da={class:"block flex-1 truncate text-left"},ma={key:0,class:"flex flex-col gap-4 py-4"},fa={class:"px-2 py-1"},pa={class:"flex flex-col gap-1"},va=Ve({inheritAttrs:!1,__name:"chats-list",props:{agent:{},publishToken:{},accessToken:{},modelValue:{}},emits:["update:modelValue","new-conversation","switch-conversation"],async setup(C,{emit:g}){let $,J;const v=C,L=g,re=At,w=Et,{t:Y}=Ae(),se=Ee(),y=st(v,"modelValue",L),E=Ue("(max-width: 768px)"),S=B(!1),b=B(!1);De(()=>{le(()=>{E.value||(S.value=!0)})}),te(E,r=>{r?S.value=!1:(b.value=!1,S.value=!0)},{immediate:!1});const{data:ce,pending:O}=([$,J]=X(()=>ee(()=>`public-agent-conversations-${v.publishToken}-${v.accessToken}`,()=>v.accessToken?Tt(v.publishToken,v.accessToken,{page:1,pageSize:50}):{items:[]},{watch:[()=>v.accessToken]})),$=await $,J(),$),h=R(()=>ce.value?.items||[]),U=R(()=>h.value?.length?Rt(h.value,"updatedAt",Y):[]);te(h,r=>{r?.length>0&&((v.modelValue?r.some(I=>I.id===v.modelValue):!1)?v.modelValue||L("switch-conversation",r[0]):(y.value=null,L("switch-conversation",r[0])))},{immediate:!0});const H=r=>{b.value=!1,L("switch-conversation",r)},j=()=>{L("new-conversation")},Z=()=>{E.value?(b.value=!0,S.value=!1):(b.value=!1,S.value=!0)},F=async r=>{const l=lt(r.title);try{const I=it({setup(){return()=>ge("div",{class:"py-2"},[ge(w,{label:"对话标题",size:"lg",required:!0,error:l.value.trim()?"":"对话标题不能为空"},{default:()=>ge(re,{modelValue:l.value,"onUpdate:modelValue":z=>{l.value=z},placeholder:"请输入对话标题",maxlength:50,class:"w-full"})})])}});await Me({title:"编辑对话标题",content:I,confirmText:"保存",cancelText:"取消",color:"primary",ui:{content:"!w-sm"}}),l.value.trim()&&l.value!==r.title&&await D(r.id,l.value)}catch(I){console.log("用户取消编辑操作:",I)}},D=async(r,l)=>{try{await St(v.publishToken,v.accessToken,r,{title:l}),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),se.success("对话标题更新成功")}catch(I){console.error("更新对话标题失败:",I)}},P=async r=>{if(v.accessToken)try{await Ft(v.publishToken,v.accessToken,r.id),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),v.modelValue===r.id&&(y.value=null,L("new-conversation")),se.success(Y("common.message.deleteSuccess"))}catch(l){console.error("删除对话失败:",l)}},ue=async r=>{try{await Me({color:"error",title:"确认删除",content:"确定要删除这个会话吗？删除后无法恢复。",confirmText:"删除",cancelText:"取消",ui:{content:"!w-sm"}})&&await P(r)}catch(l){console.log("用户取消删除操作:",l)}},de=r=>[{label:"编辑",color:"primary",icon:"i-lucide-pencil",onSelect:()=>F(r)},{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ue(r)}];return Lt({o:()=>b.value=!b.value}),(r,l)=>{const I=ot,z=Re,q=Be,s=Ut,K=Dt,ne=je,me=Bt,fe=nt;return n(),M(fe,null,{default:p(()=>[a("div",Nt,[c(Ce,{name:"sidebar"},{default:p(()=>[e(S)?(n(),m("div",Ot,[a("div",Pt,[a("div",Gt,[c(I,{src:C.agent?.avatar,alt:C.agent?.name,size:"sm"},null,8,["src","alt"]),a("div",Qt,[a("h2",Ht,x(C.agent?.name),1)]),c(q,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:l[0]||(l[0]=u=>S.value=!1)},{default:p(()=>[c(z,{name:"i-lucide-panel-left",class:"size-5"})]),_:1})]),c(q,{class:"mt-3 w-full",color:"primary",variant:"soft",onClick:j},{default:p(()=>[c(z,{name:"i-lucide-plus",class:"mr-2 size-4"}),l[4]||(l[4]=Le(" 新建会话 ",-1))]),_:1})]),a("div",Kt,[!e(U).length&&!e(O)?(n(),m("div",Jt,[a("div",Yt,[c(z,{name:"i-lucide-message-circle",size:"lg",class:"text-muted-foreground"})]),l[5]||(l[5]=a("p",null,"暂无会话记录",-1)),l[6]||(l[6]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(n(),M(ne,{key:1,class:"grid h-full"},{default:p(()=>[a("div",Zt,[(n(!0),m(T,null,A(e(U),u=>(n(),m("div",{key:u.key,class:"flex flex-col gap-2"},[a("div",Wt,x(u.label),1),a("div",Xt,[(n(!0),m(T,null,A(u.items,f=>(n(),m("div",{key:f.id,class:"group relative"},[c(q,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===C.modelValue?"soft":"ghost",color:f.id===C.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",ea,x(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),c(s,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[c(z,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===C.modelValue}]),onClick:l[1]||(l[1]=$e(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(O)?(n(),m("div",ta,[(n(),m(T,null,A(3,u=>a("div",{key:`group-${u}`,class:"flex flex-col gap-2"},[a("div",aa,[c(K,{class:"h-4 w-16"})]),a("div",sa,[(n(!0),m(T,null,A(u===1?3:u===2?2:1,f=>(n(),M(K,{key:`item-${u}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))])])):_("",!0)]),_:1}),c(Ce,{name:"fade-delay"},{default:p(()=>[e(S)?_("",!0):(n(),m("div",na,[c(q,{color:"neutral",variant:"ghost",size:"sm",class:"-ml-2 p-2",onClick:Z},{default:p(()=>[c(z,{name:"i-lucide-panel-right",class:"size-5"})]),_:1}),a("span",oa,x(C.agent?.name),1),c(q,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:j},{default:p(()=>[c(z,{name:"i-lucide-plus",class:"size-5"})]),_:1})]))]),_:1}),c(me,{open:e(b),"onUpdate:open":l[3]||(l[3]=u=>ie(b)?b.value=u:null),side:"left",ui:{content:"!w-fit flex-0 max-w-fit"}},{content:p(()=>[!e(U).length&&!e(O)?(n(),m("div",la,[a("div",ia,[c(z,{name:"i-lucide-message-circle",size:"lg",class:"text-gray-400"})]),l[7]||(l[7]=a("p",null,"暂无会话记录",-1)),l[8]||(l[8]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(n(),M(ne,{key:1,class:"h-full"},{default:p(()=>[a("div",ra,[(n(!0),m(T,null,A(e(U),u=>(n(),m("div",{key:u.key,class:"flex flex-col gap-2"},[a("div",ca,x(u.label),1),a("div",ua,[(n(!0),m(T,null,A(u.items,f=>(n(),m("div",{key:f.id,class:"group relative"},[c(q,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===C.modelValue?"soft":"ghost",color:f.id===C.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",da,x(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),c(s,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[c(z,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===C.modelValue}]),onClick:l[2]||(l[2]=$e(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(O)?(n(),m("div",ma,[(n(),m(T,null,A(3,u=>a("div",{key:`group-${u}`,class:"flex flex-col gap-2"},[a("div",fa,[c(K,{class:"h-4 w-16"})]),a("div",pa,[(n(!0),m(T,null,A(u===1?3:u===2?2:1,f=>(n(),M(K,{key:`item-${u}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),_:1},8,["open"])])]),_:1})}}}),ha=jt(va,[["__scopeId","data-v-ed9576bc"]]),ga={class:"bg-secondary h-full flex-none"},_a={key:0,class:"flex h-full w-full items-center justify-center"},xa={class:"flex items-center gap-3"},ya={class:"text-lg"},ka={key:1,class:"flex h-full w-full items-center justify-center"},ba={class:"text-center"},wa={class:"mb-2 text-xl font-semibold"},Ca={class:"text-muted-foreground"},$a={class:"flex h-12 w-full items-center justify-between px-4"},Ta={class:"flex items-center gap-2"},Sa={class:"text-lg font-semibold"},Fa={class:"text-muted-foreground text-sm"},za={key:0,class:"flex items-center gap-2"},Ma={class:"my-2 flex items-center gap-1"},Ia={class:"text-muted-foreground flex-none text-xs"},Va={key:1,class:"mb-2 space-y-2"},Aa={key:2,class:"bg-background shadow-default my-6 w-full rounded-2xl"},Ea={class:"text-foreground border-muted/10 text-md flex items-center justify-between border-b p-4 font-medium"},Ua={class:"flex items-center gap-2"},Da={key:0,class:"mt-2 p-4"},Ba={class:"w-full max-w-[800px] p-4 lg:py-2"},Ra={key:0,class:"mb-3"},La={class:"flex flex-wrap gap-2"},ja={key:0,class:"text-muted-foreground text-xs"},cs=Ve({__name:"chat",props:{billingMode:{}},async setup(C){let g,$;const J=_e(()=>xe(()=>import("./D7r3MFL-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url)),v=_e(()=>xe(()=>import("./BsZHeQ4I.js"),__vite__mapDeps([40,41,35,1,42,43,30,31,32,13,18,11,33,34,36,21]),import.meta.url)),L=_e(()=>xe(()=>import("./D7byCJqG.js"),__vite__mapDeps([44,45,1,3,4,2,46,8,27,10,13,14,15,11,47,18,29,39,24]),import.meta.url)),re=C,{t:w}=Ae(),Y=Ue("(max-width: 768px)"),{params:se}=rt(),y=R(()=>se.id||"");ct();const E=Ee(),S=ut(),b=dt("scrollAreaRef"),{height:ce}=mt(b),O=Te(`public_agent_conversation_${y.value}`),h=B(O.value||null),U=B(!0),H=B(""),j=B(null),Z=B({question:"",answer:"",enabled:!0}),F=B(!1);te(h,t=>{O.value=t});const D=ft({page:1,pageSize:15}),P=B(!1),{data:ue,refresh:de}=([g,$]=X(async()=>ee(`access-token-${y.value}`,async()=>{const t=`public_agent_token_${y.value}`,o=Te(t);if(o.value)return{accessToken:o.value,fromCache:!0};try{const d=await zt(y.value);return o.value=d.accessToken,{...d,fromCache:!1}}catch(d){throw console.error("生成访问令牌失败:",d),d}})),g=await g,$(),g),r=R(()=>ue.value?.accessToken||""),{data:l,refresh:I}=([g,$]=X(()=>ee(()=>!h.value||!r.value?(console.log("conversationId.value",h.value),{items:[],total:0,page:D.page,pageSize:D.pageSize}):Fe(y.value,r.value,h.value,D),{transform:t=>t},"$zgx5FY2pBK")),g=await g,$(),g),{data:z}=([g,$]=X(()=>ee("chat-config",()=>Vt())),g=await g,$(),g);l.value||(H.value="智能体不存在或未发布"),l.value?.items?.length||(h.value=null),P.value=l.value?.total>(l.value?.items?.length||0);const q=R(()=>l.value?.items?l.value.items.map(t=>({...t,id:t.id||Ie(),avatar:s.value?.chatAvatar||s.value?.avatar,status:"completed"})):[]),{data:s,pending:K}=([g,$]=X(()=>ee(`public-agent-${y.value}`,()=>Mt(y.value,r.value))),g=await g,$(),g),ne=()=>{h.value=null,D.page=1,u.value=[],F.value=!0,s.value&&(s.value.formFieldsInputs={})},me=async t=>{t.id!==h.value&&(h.value=t.id,D.page=1,I(),G())},fe=t=>{if(!s.value)return;const o=t.slice().reverse().find(d=>d?.role==="user"&&d.formFieldsInputs);console.log("lastUserMessage",o),s.value.formFieldsInputs=o?.formFieldsInputs||{}},{messages:u,input:f,files:W,handleSubmit:qe,reload:Ne,stop:Oe,status:Pe,error:Ge}=qt({api:It,initialMessages:[],chatConfig:{get avatar(){return s.value?.chatAvatar||s.value?.avatar}},body:{publishToken:y.value,accessToken:r.value,saveConversation:!0,get conversationId(){return h.value},get billingMode(){return re.billingMode},get formFields(){return s.value?.formFields||[]},get formFieldsInputs(){return s.value?.formFieldsInputs||{}}},onToolCall(){},onResponse(t){t.status===401&&pt().logout(!0)},onUpdate(t){t.type==="conversation_id"&&(h.value=t.data,ye(`public-agent-conversations-${y.value}-${r.value}`))},onError(t){console.error("聊天错误:",t?.message||"发送失败")},onFinish(t){console.log("聊天完成:",t)}}),pe=R(()=>Pe.value==="loading"),Qe=async()=>{if(!(!P.value||!h.value||!y.value||!r.value)){D.page++;try{const t=await Fe(y.value,r.value,h.value,D),o=t.items?.reverse().map(d=>({id:d.id||Ie(),role:d.role,content:d.content,status:"completed",mcpToolCalls:d.mcpToolCalls}))||[];u.value.unshift(...o),P.value=t.total>u.value.length}catch(t){D.page--,console.error("加载更多消息失败:",t),P.value=!0}}},ve=Se(t=>{const o=t.target,d=40;U.value=o.scrollHeight-(o.scrollTop+o.clientHeight)<=d},100),G=async(t=!0)=>{await le(),b.value?.scrollToBottom(t)},ke=()=>{if(!s.value)return E.error("智能体信息未加载"),!1;const t=s.value.formFields||[],o=s.value.formFieldsInputs||{};if(t.length===0)return!0;const d=[];return t.forEach(k=>{if(k.required){const V=o[k.name];(!V||typeof V=="string"&&V.trim()==="")&&d.push(`${k.label}是必填字段`)}}),d.length>0?(E.error(`表单验证失败: ${d.join(", ")}`),!1):!0},He=()=>{ke()&&(F.value=!1)},oe=async t=>{if(!(!t.trim()||pe.value)){if(!s.value)return E.error("智能体信息未加载");if(!r.value)return E.error("请先生成访问令牌");ke()&&(await qe(t),G())}};te(q,t=>{t&&(u.value=[...t],fe(t),le(()=>{t.length>0?G(!1):F.value=!0}))},{immediate:!0}),te(()=>u.value.at(-1)?.content,()=>{le(()=>{U.value&&G(!1)})},{flush:"post"});const Ke=t=>{S.create(v).open({context:t})},Je=(t,o=null)=>{j.value=o,S.create(J).open({agentId:s.value?.id,annotationId:t,messageId:o,isPublic:!0,publishToken:y.value,accessToken:r.value,initialData:void 0,onResult:k=>{be(!0,k)}})},Ye=(t,o)=>{const d=u.value[o-1];if(!d||d.role!=="user"){E.error("找不到对应的用户问题");return}Z.value={question:ze(d.content),answer:ze(t.content),enabled:!0},j.value=t.id||null,S.create(J).open({agentId:s.value?.id,annotationId:null,messageId:t.id||null,isPublic:!0,publishToken:y.value,accessToken:r.value,initialData:Z.value,onResult:V=>{be(!0,V)}})};function be(t,o){if(o?.id&&j.value){const d=u.value.findIndex(k=>k.id===j.value);if(d>=0){const k=u.value[d];k&&!k.metadata&&(k.metadata={}),k?.metadata&&(k.metadata.annotations={annotationId:o.id,createdBy:"",question:"",similarity:1})}}j.value=null,Z.value={question:"",answer:"",enabled:!0}}let he=null;return De(async()=>{G(!1);const t=b.value?.getViewportElement(),o=t&&t.viewportElement;if(o){o.addEventListener("scroll",ve,{passive:!0}),ve({target:o});const d=Se(()=>{U.value&&G(!1)},50);he=new MutationObserver(()=>{d()}),he.observe(o,{childList:!0,subtree:!1,characterData:!1})}}),vt(()=>{const t=b.value?.getViewportElement();(t&&t.viewportElement)?.removeEventListener("scroll",ve),he?.disconnect()}),ht({title:R(()=>s.value?`${s.value.name} - BuildingAI`:"BuildingAI"),link:[{rel:"icon",href:R(()=>s.value?.avatar||"/favicon.ico")},{rel:"apple-touch-icon",href:R(()=>s.value?.avatar||"/favicon.ico")}]}),(t,o)=>{const d=Re,k=yt,V=Be,we=bt,Ze=wt,We=Ct,Xe=kt,et=je,tt=xt,at=$t;return n(),m("div",{class:ae(["ai-chat bg-secondary flex h-full min-h-0 items-center justify-center rounded-l-xl p-2",{"p-0!":e(Y)}])},[a("div",ga,[c(ha,{agent:e(s),"publish-token":e(y),"access-token":e(r),modelValue:e(h),"onUpdate:modelValue":o[0]||(o[0]=i=>ie(h)?h.value=i:null),onNewConversation:ne,onSwitchConversation:me},null,8,["agent","publish-token","access-token","modelValue"])]),a("div",{class:ae(["bg-background flex h-full min-h-0 w-full flex-col items-center rounded-xl",{"rounded-none!":e(Y)}])},[e(K)?(n(),m("div",_a,[a("div",xa,[c(d,{name:"i-lucide-loader-2",class:"text-primary size-6 animate-spin"}),a("span",ya,x(t.$t("ai-agent.frontend.chat.loadingAgent")),1)])])):e(H)?(n(),m("div",ka,[a("div",ba,[c(d,{name:"i-lucide-alert-circle",class:"text-error mx-auto mb-4 size-12"}),a("h2",wa,x(t.$t("ai-agent.frontend.chat.loadingFailed")),1),a("p",Ca,x(e(H)),1)])])):e(s)?(n(),m(T,{key:2},[a("div",$a,[a("div",Ta,[a("span",Sa,x(e(s).name),1)])]),c(et,{class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:b,onInView:o[3]||(o[3]=i=>G(!1))},{default:p(()=>[c(Xe,{loading:!1,"has-more":e(P),threshold:500,"content-class":"max-w-[800px] w-full space-y-3 p-4 lg:py-4",onLoadMore:Qe},{default:p(()=>[e(u).length===0&&(!e(F)||!e(s).formFields?.length)&&e(s).openingStatement?.length&&e(s).openingQuestions?.length?(n(),M(we,{key:0,messages:[{role:"assistant",avatar:e(s)?.chatAvatar||e(s)?.avatar,content:e(s)?.openingStatement||""}],"scroll-area-height":200,assistant:{actions:[]}},{content:p(({message:i})=>[c(k,{content:i.content.toString(),"show-run-button":!1},null,8,["content"]),a("div",{class:ae(["flex flex-col gap-2",{"ml-4":e(s)?.avatar}])},[a("div",Fa,x(t.$t("ai-agent.frontend.chat.youCanAskMe")),1),(n(!0),m(T,null,A(e(s)?.openingQuestions||[],N=>(n(),m("div",{key:N},[c(V,{label:N,color:"primary",variant:"soft",onClick:Q=>oe(N)},null,8,["label","onClick"])]))),128))],2)]),_:1},8,["messages"])):_("",!0),e(u).length!==0?(n(),M(we,{key:1,messages:e(u),"scroll-area-height":e(ce),error:e(Ge),assistant:{actions:[{label:e(w)("ai-chat.frontend.messages.retry"),icon:"i-lucide-rotate-cw-square",onClick:()=>e(Ne)()},{label:e(w)("ai-agent.frontend.chat.chatContext"),icon:"i-lucide-file-type",show:!e(s).showContext,onClick:i=>{i?.metadata?.context?Ke(i.metadata.context):e(E).error(e(w)("ai-agent.backend.configuration.noChatContext"))}},{label:e(w)("ai-agent.frontend.chat.annotation"),icon:"i-lucide-wrap-text",show:!e(s).enableFeedback,onClick:(i,N)=>{const Q=i.metadata?.annotations?.annotationId;Q?Je(Q,i.id):Ye(i,N)}}]},"spacing-offset":160},{content:p(({message:i,index:N})=>[i.content.length?(n(),M(k,{key:0,content:i.content.toString(),"show-run-button":!1},{before:p(()=>[i.status==="loading"?(n(),m("div",za,[c(d,{name:"i-lucide-loader-2",class:"animate-spin"}),a("span",null,x(e(w)("ai-chat.frontend.messages.thinking")),1)])):_("",!0)]),after:p(()=>[i.metadata?.references&&i.metadata.references.length>0&&i.role==="assistant"&&!e(pe)&&e(s).showReference?(n(),m(T,{key:0},[a("div",Ma,[a("span",Ia,x(e(w)("ai-agent.frontend.chat.reference")),1),i.metadata?.references&&i.metadata.references.length>0&&i.role==="assistant"?(n(),M(Ze,{key:0,size:"xs",type:"dashed"})):_("",!0)]),c(We,{references:i.metadata.references},null,8,["references"])],64)):_("",!0)]),_:2},1032,["content"])):_("",!0),i.metadata?.suggestions&&e(u).length-1===N?(n(),m("div",Va,[(n(!0),m(T,null,A(i.metadata.suggestions,Q=>(n(),m("div",{key:Q},[c(V,{label:Q,color:"primary",variant:"soft",onClick:qa=>oe(Q)},null,8,["label","onClick"])]))),128))])):_("",!0)]),_:1},8,["messages","scroll-area-height","error","assistant"])):_("",!0),e(s).formFields&&e(s).formFields.length>0?(n(),m("div",Aa,[a("div",Ea,[a("span",Ua,[c(d,{name:"i-lucide-bot-message-square",class:"text-primary size-7"}),Le(" "+x(e(w)("ai-agent.frontend.chat.newConversationSettings")),1)]),e(u).length||!e(F)?(n(),M(V,{key:0,color:"primary",variant:"ghost",size:"sm",onClick:o[1]||(o[1]=i=>F.value=!e(F))},{default:p(()=>[a("span",null,x(e(F)?e(w)("console-common.close"):e(w)("console-common.edit")),1)]),_:1})):_("",!0)]),gt(a("div",null,[c(e(L),{inputs:e(s).formFieldsInputs,"onUpdate:inputs":o[2]||(o[2]=i=>e(s).formFieldsInputs=i),formFields:e(s).formFields,class:"w-full bg-transparent pt-0",formClass:"bg-muted hover:bg-muted"},null,8,["inputs","formFields"])],512),[[_t,e(F)]]),e(u).length===0&&e(F)?(n(),m("div",Da,[c(V,{color:"primary",class:"w-full justify-center",onClick:He},{default:p(()=>[a("span",null,x(e(w)("ai-agent.frontend.chat.startConversation")),1)]),_:1})])):_("",!0)])):_("",!0)]),_:1},8,["has-more"])]),_:1},512),a("div",Ba,[e(s).quickCommands?.length?(n(),m("div",Ra,[a("div",La,[(n(!0),m(T,null,A(e(s).quickCommands,i=>(n(),M(V,{key:i.name,color:"neutral",variant:"soft",size:"sm",onClick:N=>oe(i.content)},{default:p(()=>[i.avatar?(n(),M(tt,{key:0,src:i.avatar,class:"h-4 w-4"},null,8,["src"])):_("",!0),a("span",null,x(i.name),1)]),_:2},1032,["onClick"]))),128))])])):_("",!0),c(at,{modelValue:e(f),"onUpdate:modelValue":o[4]||(o[4]=i=>ie(f)?f.value=i:null),"file-list":e(W),"onUpdate:fileList":o[5]||(o[5]=i=>ie(W)?W.value=i:null),"is-loading":e(pe),placeholder:e(w)("ai-chat.frontend.and",{name:e(s).name}),attachmentSizeLimit:e(z)?.attachmentSizeLimit,class:"sticky bottom-0 z-10 [view-transition-name:chat-prompt]",rows:1,onStop:e(Oe),onSubmit:oe},{"panel-right-item":p(()=>[(e(s).billingConfig?.price??0)>0?(n(),m("span",ja,x(e(w)("ai-chat.frontend.singleRunConsumption",{price:e(s).billingConfig?.price??0})),1)):_("",!0)]),_:1},8,["modelValue","file-list","is-loading","placeholder","attachmentSizeLimit","onStop"])])],64)):_("",!0)],2)],2)}}});export{cs as _};

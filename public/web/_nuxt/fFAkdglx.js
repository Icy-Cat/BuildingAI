const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D7r3MFL-.js","./DChYRXkg.js","./CjnkMdLn.js","./Cgx-pZ0i.js","./DDkKkiq3.js","./DOkYLxiv.js","./BvrbnHlJ.js","./BaddN8Qc.js","./8-c-A7PB.js","./kRIii9yh.js","./BwjX1SxC.js","./Cfcu-t3n.js","./C6Y-ieo6.js","./b-_TUx9i.js","./DaNf1Wdt.js","./CKXZhss7.js","./Cpt2kRVT.js","./pUN2d83w.js","./B22A-h4k.js","./Bub1HYiY.js","./Bpk8zbrs.js","./XpsTG8vq.js","./DAB2a9hE.js","./BMSQkwth.js","./DaWZu8wl.js","./8nwS_hHr.js","./-p_U-LXi.js","./DN9ov8OT.js","./iHyFjswr.js","./Bc7ldEoJ.js","./DNZiHWQV.js","./zPUvkbEL.js","./BNqXk1Oe.js","./DK1-6_6O.js","./CstU5cVH.js","./BT1VXOqk.js","./CP4Zo7YT.js","./CWtbjjIF.js","./DTJhkpWV.js","./BUyfW8JT.js","./BsZHeQ4I.js","./Qjq6OWkd.js","./Dn8X9Gvz.js","./DlAUqK2U.js","./D7byCJqG.js","./-aacq5Xj.js","./DjV6S4bm.js","./BstbYvQo.js"])))=>i.map(i=>d[i]);
import{d as Ie,b as Me,aq as Ae,b9 as Ee,s as L,i as Ue,G as ie,w as te,aZ as X,a_ as ee,g as R,aS as at,j as $,o as n,b7 as st,k as p,m as a,l as u,c as m,n as _,T as nt,p as e,C as ot,t as x,z as De,_ as Be,q as Le,F as S,B as A,v as Ce,x as ae,A as re,f as lt,aT as it,h as ge,aL as ye,aJ as rt,au as ct,Q as ut,e as dt,aN as mt,O as $e,a1 as ft,ap as pt,bF as Te,ah as vt,aV as ht,D as gt,R as _e,E as _t,bs as xt,U as xe}from"#entry";import{_ as yt}from"./_1k1KbFY.js";import{_ as kt,a as bt}from"./B564akus.js";import{_ as wt}from"./BBNTTFau.js";import{_ as Ct}from"./BIVu-AGc.js";import{_ as Re}from"./Qjq6OWkd.js";import{_ as $t}from"./DILziS8N.js";import{g as Tt,h as St,i as Ft,j as zt,k as Se,l as Vt,m as It}from"./DTJhkpWV.js";import{e as Mt}from"./B1XcE43x.js";import{e as Fe}from"./Bni8bPEl.js";import At from"./-aacq5Xj.js";import{_ as Et}from"./Cgx-pZ0i.js";import{_ as Ut}from"./BvrbnHlJ.js";import{_ as Dt}from"./C8CK8nAU.js";import{_ as Bt}from"./BQnzPqK6.js";import{g as Lt}from"./eeyg4-1U.js";import{u as ze}from"./BvugyUor.js";import{d as Rt}from"./CP4Zo7YT.js";import{_ as jt}from"./DlAUqK2U.js";import{u as Ve}from"./BI1JbAYD.js";import{u as Nt}from"./DqNHTeRY.js";const qt={class:"relative h-full flex-1"},Ot={key:0,class:"flex h-full min-h-0 w-[240px] flex-col"},Pt={class:"border-border/50 border-b p-4"},Gt={class:"flex items-center gap-3"},Qt={class:"min-w-0 flex-1"},Ht={class:"truncate font-medium"},Kt={class:"h-full flex-1 overflow-hidden"},Jt={key:0,class:"text-muted-foreground flex h-full flex-col items-center justify-center text-center text-sm"},Yt={class:"mb-2"},Zt={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},Wt={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},Xt={class:"flex flex-col gap-1"},ea={class:"block flex-1 truncate text-left"},ta={key:0,class:"flex flex-col gap-4 py-4"},aa={class:"px-2 py-1"},sa={class:"flex flex-col gap-1"},na={key:0,class:"absolute top-4 left-4 z-50 flex items-center gap-2"},oa={class:"group relative"},la={class:"block flex-1 truncate text-left text-sm"},ia={key:0,class:"text-muted-foreground flex h-full w-50 flex-col items-center justify-center text-center text-sm"},ra={class:"mb-2"},ca={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},ua={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},da={class:"flex flex-col gap-1"},ma={class:"block flex-1 truncate text-left"},fa={key:0,class:"flex flex-col gap-4 py-4"},pa={class:"px-2 py-1"},va={class:"flex flex-col gap-1"},ha=Ie({inheritAttrs:!1,__name:"chats-list",props:{agent:{},publishToken:{},accessToken:{},modelValue:{}},emits:["update:modelValue","new-conversation","switch-conversation"],async setup(b,{emit:g}){let T,J;const v=b,j=g,ce=At,C=Et,{t:Y}=Me(),se=Ae(),y=at(v,"modelValue",j),E=Ee("(max-width: 768px)"),F=L(!1),w=L(!1);Ue(()=>{ie(()=>{E.value||(F.value=!0)})}),te(E,c=>{c?F.value=!1:(w.value=!1,F.value=!0)},{immediate:!1});const{data:ue,pending:O}=([T,J]=X(()=>ee(()=>`public-agent-conversations-${v.publishToken}-${v.accessToken}`,()=>v.accessToken?Tt(v.publishToken,v.accessToken,{page:1,pageSize:50}):{items:[]},{watch:[()=>v.accessToken]})),T=await T,J(),T),h=R(()=>ue.value?.items||[]),U=R(()=>h.value?.length?Lt(h.value,"updatedAt",Y):[]);te(h,c=>{c?.length>0&&((v.modelValue?c.some(I=>I.id===v.modelValue):!1)?v.modelValue||j("switch-conversation",c[0]):(y.value=null,j("switch-conversation",c[0])))},{immediate:!0});const H=c=>{w.value=!1,j("switch-conversation",c)},N=()=>{j("new-conversation")},Z=()=>{E.value?(w.value=!0,F.value=!1):(w.value=!1,F.value=!0)},z=async c=>{const o=lt(c.title);try{const I=it({setup(){return()=>ge("div",{class:"py-2"},[ge(C,{label:"对话标题",size:"lg",required:!0,error:o.value.trim()?"":"对话标题不能为空"},{default:()=>ge(ce,{modelValue:o.value,"onUpdate:modelValue":V=>{o.value=V},placeholder:"请输入对话标题",maxlength:50,class:"w-full"})})])}});await ze({title:"编辑对话标题",content:I,confirmText:"保存",cancelText:"取消",color:"primary",ui:{content:"!w-sm"}}),o.value.trim()&&o.value!==c.title&&await D(c.id,o.value)}catch(I){console.log("用户取消编辑操作:",I)}},D=async(c,o)=>{try{await St(v.publishToken,v.accessToken,c,{title:o}),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),se.success("对话标题更新成功")}catch(I){console.error("更新对话标题失败:",I)}},P=async c=>{if(v.accessToken)try{await Ft(v.publishToken,v.accessToken,c.id),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),v.modelValue===c.id&&(y.value=null,j("new-conversation")),se.success(Y("common.message.deleteSuccess"))}catch(o){console.error("删除对话失败:",o)}},ne=async c=>{try{await ze({color:"error",title:"确认删除",content:"确定要删除这个会话吗？删除后无法恢复。",confirmText:"删除",cancelText:"取消",ui:{content:"!w-sm"}})&&await P(c)}catch(o){console.log("用户取消删除操作:",o)}},de=c=>[{label:"编辑",color:"primary",icon:"i-lucide-pencil",onSelect:()=>z(c)},{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(c)}];return Rt({o:()=>w.value=!w.value}),(c,o)=>{const I=ot,V=Be,B=De,s=Ut,K=Dt,oe=Re,me=Bt,fe=st;return n(),$(fe,null,{default:p(()=>[a("div",qt,[u(nt,{name:"sidebar"},{default:p(()=>[e(F)?(n(),m("div",Ot,[a("div",Pt,[a("div",Gt,[u(I,{src:b.agent?.avatar,alt:b.agent?.name,size:"sm"},null,8,["src","alt"]),a("div",Qt,[a("h2",Ht,x(b.agent?.name),1)]),u(B,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:o[0]||(o[0]=i=>F.value=!1)},{default:p(()=>[u(V,{name:"i-lucide-panel-left",class:"size-5"})]),_:1})]),u(B,{class:"mt-3 w-full",color:"primary",variant:"soft",onClick:N},{default:p(()=>[u(V,{name:"i-lucide-plus",class:"mr-2 size-4"}),o[4]||(o[4]=Le(" 新建会话 ",-1))]),_:1})]),a("div",Kt,[!e(U).length&&!e(O)?(n(),m("div",Jt,[a("div",Yt,[u(V,{name:"i-lucide-message-circle",size:"lg",class:"text-muted-foreground"})]),o[5]||(o[5]=a("p",null,"暂无会话记录",-1)),o[6]||(o[6]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(n(),$(oe,{key:1,class:"grid h-full"},{default:p(()=>[a("div",Zt,[(n(!0),m(S,null,A(e(U),i=>(n(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",Wt,x(i.label),1),a("div",Xt,[(n(!0),m(S,null,A(i.items,f=>(n(),m("div",{key:f.id,class:"group relative"},[u(B,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",ea,x(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(s,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(V,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:o[1]||(o[1]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(O)?(n(),m("div",ta,[(n(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",aa,[u(K,{class:"h-4 w-16"})]),a("div",sa,[(n(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(n(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))])])):_("",!0)]),_:1}),e(F)?_("",!0):(n(),m("div",na,[u(B,{color:"neutral",variant:"soft",size:"lg",class:"p-2",onClick:Z},{default:p(()=>[u(V,{name:"i-lucide-panel-right",class:"size-5"})]),_:1}),o[8]||(o[8]=a("div",{class:"text-muted-foreground mx-1"},"/",-1)),a("div",oa,[b.modelValue?(n(),$(s,{key:1,items:[{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(e(h).find(i=>i.id===b.modelValue))},{label:"新建对话",color:"primary",icon:"i-lucide-plus",onSelect:()=>N()}],ui:{content:"w-32",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"bottom",align:"center"}},{default:p(()=>[u(B,{label:e(h).find(i=>i.id===b.modelValue)?.title||"当前对话",variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[a("span",la,x(e(h).find(i=>i.id===b.modelValue)?.title||"当前对话"),1),u(V,{name:"i-lucide-chevron-down",class:"size-5"})]),_:1},8,["label"])]),_:1},8,["items"])):(n(),$(B,{key:0,variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[...o[7]||(o[7]=[a("span",{class:"block flex-1 truncate text-left text-sm"},"New Chat",-1)])]),_:1}))])])),u(me,{open:e(w),"onUpdate:open":o[3]||(o[3]=i=>re(w)?w.value=i:null),side:"left",ui:{content:"!w-fit flex-0 max-w-fit"}},{content:p(()=>[!e(U).length&&!e(O)?(n(),m("div",ia,[a("div",ra,[u(V,{name:"i-lucide-message-circle",size:"lg",class:"text-gray-400"})]),o[9]||(o[9]=a("p",null,"暂无会话记录",-1)),o[10]||(o[10]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(n(),$(oe,{key:1,class:"h-full"},{default:p(()=>[a("div",ca,[(n(!0),m(S,null,A(e(U),i=>(n(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",ua,x(i.label),1),a("div",da,[(n(!0),m(S,null,A(i.items,f=>(n(),m("div",{key:f.id,class:"group relative"},[u(B,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",ma,x(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(s,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(V,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:o[2]||(o[2]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(O)?(n(),m("div",fa,[(n(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",pa,[u(K,{class:"h-4 w-16"})]),a("div",va,[(n(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(n(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),_:1},8,["open"])])]),_:1})}}}),ga=jt(ha,[["__scopeId","data-v-c79a2347"]]),_a={class:"bg-secondary h-full flex-none"},xa={key:0,class:"flex h-full w-full items-center justify-center"},ya={class:"flex items-center gap-3"},ka={class:"text-lg"},ba={key:1,class:"flex h-full w-full items-center justify-center"},wa={class:"text-center"},Ca={class:"mb-2 text-xl font-semibold"},$a={class:"text-muted-foreground"},Ta={class:"flex h-12 w-full items-center justify-between px-4"},Sa={class:"flex items-center gap-2"},Fa={class:"text-lg font-semibold"},za={class:"text-muted-foreground text-sm"},Va={key:0,class:"flex items-center gap-2"},Ia={class:"my-2 flex items-center gap-1"},Ma={class:"text-muted-foreground flex-none text-xs"},Aa={key:1,class:"mb-2 space-y-2"},Ea={key:2,class:"bg-background shadow-default my-6 w-full rounded-2xl"},Ua={class:"text-foreground border-muted/10 text-md flex items-center justify-between border-b p-4 font-medium"},Da={class:"flex items-center gap-2"},Ba={key:0,class:"mt-2 p-4"},La={class:"w-full max-w-[800px] p-4 lg:py-2"},Ra={key:0,class:"mb-3"},ja={class:"flex flex-wrap gap-2"},Na={key:0,class:"text-muted-foreground text-xs"},us=Ie({__name:"chat",props:{billingMode:{}},async setup(b){let g,T;const J=_e(()=>xe(()=>import("./D7r3MFL-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url)),v=_e(()=>xe(()=>import("./BsZHeQ4I.js"),__vite__mapDeps([40,41,35,1,42,43,30,31,32,13,18,11,33,34,36,21]),import.meta.url)),j=_e(()=>xe(()=>import("./D7byCJqG.js"),__vite__mapDeps([44,45,1,3,4,2,46,8,27,10,13,14,15,11,47,18,29,39,24]),import.meta.url)),ce=b,{t:C}=Me(),Y=Ee("(max-width: 768px)"),{params:se}=rt(),y=R(()=>se.id||"");ct();const E=Ae(),F=ut(),w=dt("scrollAreaRef"),{height:ue}=mt(w),O=$e(`public_agent_conversation_${y.value}`),h=L(O.value||null),U=L(!0),H=L(""),N=L(null),Z=L({question:"",answer:"",enabled:!0}),z=L(!1);te(h,t=>{O.value=t});const D=ft({page:1,pageSize:15}),P=L(!1),{data:ne,refresh:de}=([g,T]=X(async()=>ee(`access-token-${y.value}`,async()=>{const t=`public_agent_token_${y.value}`,l=$e(t);if(l.value)return{accessToken:l.value,fromCache:!0};try{const d=await zt(y.value);return l.value=d.accessToken,{...d,fromCache:!1}}catch(d){throw console.error("生成访问令牌失败:",d),d}})),g=await g,T(),g),c=R(()=>ne.value?.accessToken||""),{data:o,refresh:I}=([g,T]=X(()=>ee(()=>!h.value||!c.value?(console.log("conversationId.value",h.value),{items:[],total:0,page:D.page,pageSize:D.pageSize}):Se(y.value,c.value,h.value,D),{transform:t=>t},"$zgx5FY2pBK")),g=await g,T(),g),{data:V}=([g,T]=X(()=>ee("chat-config",()=>Mt())),g=await g,T(),g);o.value||(H.value="智能体不存在或未发布"),o.value?.items?.length||(h.value=null),P.value=o.value?.total>(o.value?.items?.length||0);const B=R(()=>o.value?.items?o.value.items.map(t=>({...t,id:t.id||Ve(),avatar:s.value?.chatAvatar||s.value?.avatar,status:"completed"})):[]),{data:s,pending:K}=([g,T]=X(()=>ee(`public-agent-${y.value}`,()=>Vt(y.value,c.value))),g=await g,T(),g),oe=()=>{h.value=null,D.page=1,i.value=[],z.value=!0,s.value&&(s.value.formFieldsInputs={})},me=async t=>{t.id!==h.value&&(h.value=t.id,D.page=1,I(),G())},fe=t=>{if(!s.value)return;const l=t.slice().reverse().find(d=>d?.role==="user"&&d.formFieldsInputs);console.log("lastUserMessage",l),s.value.formFieldsInputs=l?.formFieldsInputs||{}},{messages:i,input:f,files:W,handleSubmit:je,reload:Ne,stop:qe,status:Oe,error:Pe}=Nt({api:It,initialMessages:[],chatConfig:{get avatar(){return s.value?.chatAvatar||s.value?.avatar}},body:{publishToken:y.value,accessToken:c.value,saveConversation:!0,get conversationId(){return h.value},get billingMode(){return ce.billingMode},get formFields(){return s.value?.formFields||[]},get formFieldsInputs(){return s.value?.formFieldsInputs||{}}},onToolCall(){},onResponse(t){t.status===401&&pt().logout(!0)},onUpdate(t){t.type==="conversation_id"&&(h.value=t.data,ye(`public-agent-conversations-${y.value}-${c.value}`))},onError(t){console.error("聊天错误:",t?.message||"发送失败")},onFinish(t){console.log("聊天完成:",t)}}),pe=R(()=>Oe.value==="loading"),Ge=async()=>{if(!(!P.value||!h.value||!y.value||!c.value)){D.page++;try{const t=await Se(y.value,c.value,h.value,D),l=t.items?.reverse().map(d=>({id:d.id||Ve(),role:d.role,content:d.content,status:"completed",mcpToolCalls:d.mcpToolCalls}))||[];i.value.unshift(...l),P.value=t.total>i.value.length}catch(t){D.page--,console.error("加载更多消息失败:",t),P.value=!0}}},ve=Te(t=>{const l=t.target,d=40;U.value=l.scrollHeight-(l.scrollTop+l.clientHeight)<=d},100),G=async(t=!0)=>{await ie(),w.value?.scrollToBottom(t)},ke=()=>{if(!s.value)return E.error("智能体信息未加载"),!1;const t=s.value.formFields||[],l=s.value.formFieldsInputs||{};if(t.length===0)return!0;const d=[];return t.forEach(k=>{if(k.required){const M=l[k.name];(!M||typeof M=="string"&&M.trim()==="")&&d.push(`${k.label}是必填字段`)}}),d.length>0?(E.error(`表单验证失败: ${d.join(", ")}`),!1):!0},Qe=()=>{ke()&&(z.value=!1)},le=async t=>{if(!(!t.trim()||pe.value)){if(!s.value)return E.error("智能体信息未加载");if(!c.value)return E.error("请先生成访问令牌");ke()&&(await je(t),G())}};te(B,t=>{t&&(i.value=[...t],fe(t),ie(()=>{t.length>0?G(!1):z.value=!0}))},{immediate:!0}),te(()=>i.value.at(-1)?.content,()=>{ie(()=>{U.value&&G(!1)})},{flush:"post"});const He=t=>{F.create(v).open({context:t})},Ke=(t,l=null)=>{N.value=l,F.create(J).open({agentId:s.value?.id,annotationId:t,messageId:l,isPublic:!0,publishToken:y.value,accessToken:c.value,initialData:void 0,onResult:k=>{be(!0,k)}})},Je=(t,l)=>{const d=i.value[l-1];if(!d||d.role!=="user"){E.error("找不到对应的用户问题");return}Z.value={question:Fe(d.content),answer:Fe(t.content),enabled:!0},N.value=t.id||null,F.create(J).open({agentId:s.value?.id,annotationId:null,messageId:t.id||null,isPublic:!0,publishToken:y.value,accessToken:c.value,initialData:Z.value,onResult:M=>{be(!0,M)}})};function be(t,l){if(l?.id&&N.value){const d=i.value.findIndex(k=>k.id===N.value);if(d>=0){const k=i.value[d];k&&!k.metadata&&(k.metadata={}),k?.metadata&&(k.metadata.annotations={annotationId:l.id,createdBy:"",question:"",similarity:1})}}N.value=null,Z.value={question:"",answer:"",enabled:!0}}let he=null;return Ue(async()=>{G(!1);const t=w.value?.getViewportElement(),l=t&&t.viewportElement;if(l){l.addEventListener("scroll",ve,{passive:!0}),ve({target:l});const d=Te(()=>{U.value&&G(!1)},50);he=new MutationObserver(()=>{d()}),he.observe(l,{childList:!0,subtree:!1,characterData:!1})}}),vt(()=>{const t=w.value?.getViewportElement();(t&&t.viewportElement)?.removeEventListener("scroll",ve),he?.disconnect()}),ht({title:R(()=>s.value?`${s.value.name} - BuildingAI`:"BuildingAI"),link:[{rel:"icon",href:R(()=>s.value?.avatar||"/favicon.ico")},{rel:"apple-touch-icon",href:R(()=>s.value?.avatar||"/favicon.ico")}]}),(t,l)=>{const d=Be,k=yt,M=De,we=bt,Ye=wt,Ze=Ct,We=kt,Xe=Re,et=xt,tt=$t;return n(),m("div",{class:ae(["ai-chat bg-secondary flex h-full min-h-0 items-center justify-center rounded-l-xl p-2",{"p-0!":e(Y)}])},[a("div",_a,[u(ga,{agent:e(s),"publish-token":e(y),"access-token":e(c),modelValue:e(h),"onUpdate:modelValue":l[0]||(l[0]=r=>re(h)?h.value=r:null),onNewConversation:oe,onSwitchConversation:me},null,8,["agent","publish-token","access-token","modelValue"])]),a("div",{class:ae(["bg-background flex h-full min-h-0 w-full flex-col items-center rounded-xl",{"rounded-none!":e(Y)}])},[e(K)?(n(),m("div",xa,[a("div",ya,[u(d,{name:"i-lucide-loader-2",class:"text-primary size-6 animate-spin"}),a("span",ka,x(t.$t("ai-agent.frontend.chat.loadingAgent")),1)])])):e(H)?(n(),m("div",ba,[a("div",wa,[u(d,{name:"i-lucide-alert-circle",class:"text-error mx-auto mb-4 size-12"}),a("h2",Ca,x(t.$t("ai-agent.frontend.chat.loadingFailed")),1),a("p",$a,x(e(H)),1)])])):e(s)?(n(),m(S,{key:2},[a("div",Ta,[a("div",Sa,[a("span",Fa,x(e(s).name),1)])]),u(Xe,{class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:w,onInView:l[3]||(l[3]=r=>G(!1))},{default:p(()=>[u(We,{loading:!1,"has-more":e(P),threshold:500,"content-class":"max-w-[800px] w-full space-y-3 p-4 lg:py-4",onLoadMore:Ge},{default:p(()=>[e(i).length===0&&(!e(z)||!e(s).formFields?.length)&&e(s).openingStatement?.length&&e(s).openingQuestions?.length?(n(),$(we,{key:0,messages:[{role:"assistant",avatar:e(s)?.chatAvatar||e(s)?.avatar,content:e(s)?.openingStatement||""}],"scroll-area-height":200,assistant:{actions:[]}},{content:p(({message:r})=>[u(k,{content:r.content.toString(),"show-run-button":!1},null,8,["content"]),a("div",{class:ae(["flex flex-col gap-2",{"ml-4":e(s)?.avatar}])},[a("div",za,x(t.$t("ai-agent.frontend.chat.youCanAskMe")),1),(n(!0),m(S,null,A(e(s)?.openingQuestions||[],q=>(n(),m("div",{key:q},[u(M,{label:q,color:"primary",variant:"soft",onClick:Q=>le(q)},null,8,["label","onClick"])]))),128))],2)]),_:1},8,["messages"])):_("",!0),e(i).length!==0?(n(),$(we,{key:1,messages:e(i),"scroll-area-height":e(ue),error:e(Pe),assistant:{actions:[{label:e(C)("ai-chat.frontend.messages.retry"),icon:"i-lucide-rotate-cw-square",onClick:()=>e(Ne)()},{label:e(C)("ai-agent.frontend.chat.chatContext"),icon:"i-lucide-file-type",show:!e(s).showContext,onClick:r=>{r?.metadata?.context?He(r.metadata.context):e(E).error(e(C)("ai-agent.backend.configuration.noChatContext"))}},{label:e(C)("ai-agent.frontend.chat.annotation"),icon:"i-lucide-wrap-text",show:!e(s).enableFeedback,onClick:(r,q)=>{const Q=r.metadata?.annotations?.annotationId;Q?Ke(Q,r.id):Je(r,q)}}]},"spacing-offset":160},{content:p(({message:r,index:q})=>[r.content.length?(n(),$(k,{key:0,content:r.content.toString(),"show-run-button":!1},{before:p(()=>[r.status==="loading"?(n(),m("div",Va,[u(d,{name:"i-lucide-loader-2",class:"animate-spin"}),a("span",null,x(e(C)("ai-chat.frontend.messages.thinking")),1)])):_("",!0)]),after:p(()=>[r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"&&!e(pe)&&e(s).showReference?(n(),m(S,{key:0},[a("div",Ia,[a("span",Ma,x(e(C)("ai-agent.frontend.chat.reference")),1),r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"?(n(),$(Ye,{key:0,size:"xs",type:"dashed"})):_("",!0)]),u(Ze,{references:r.metadata.references},null,8,["references"])],64)):_("",!0)]),_:2},1032,["content"])):_("",!0),r.metadata?.suggestions&&e(i).length-1===q?(n(),m("div",Aa,[(n(!0),m(S,null,A(r.metadata.suggestions,Q=>(n(),m("div",{key:Q},[u(M,{label:Q,color:"primary",variant:"soft",onClick:qa=>le(Q)},null,8,["label","onClick"])]))),128))])):_("",!0)]),_:1},8,["messages","scroll-area-height","error","assistant"])):_("",!0),e(s).formFields&&e(s).formFields.length>0?(n(),m("div",Ea,[a("div",Ua,[a("span",Da,[u(d,{name:"i-lucide-bot-message-square",class:"text-primary size-7"}),Le(" "+x(e(C)("ai-agent.frontend.chat.newConversationSettings")),1)]),e(i).length||!e(z)?(n(),$(M,{key:0,color:"primary",variant:"ghost",size:"sm",onClick:l[1]||(l[1]=r=>z.value=!e(z))},{default:p(()=>[a("span",null,x(e(z)?e(C)("console-common.close"):e(C)("console-common.edit")),1)]),_:1})):_("",!0)]),gt(a("div",null,[u(e(j),{inputs:e(s).formFieldsInputs,"onUpdate:inputs":l[2]||(l[2]=r=>e(s).formFieldsInputs=r),formFields:e(s).formFields,class:"w-full bg-transparent pt-0",formClass:"bg-muted hover:bg-muted"},null,8,["inputs","formFields"])],512),[[_t,e(z)]]),e(i).length===0&&e(z)?(n(),m("div",Ba,[u(M,{color:"primary",class:"w-full justify-center",onClick:Qe},{default:p(()=>[a("span",null,x(e(C)("ai-agent.frontend.chat.startConversation")),1)]),_:1})])):_("",!0)])):_("",!0)]),_:1},8,["has-more"])]),_:1},512),a("div",La,[e(s).quickCommands?.length?(n(),m("div",Ra,[a("div",ja,[(n(!0),m(S,null,A(e(s).quickCommands,r=>(n(),$(M,{key:r.name,color:"neutral",variant:"soft",size:"sm",onClick:q=>le(r.content)},{default:p(()=>[r.avatar?(n(),$(et,{key:0,src:r.avatar,class:"h-4 w-4"},null,8,["src"])):_("",!0),a("span",null,x(r.name),1)]),_:2},1032,["onClick"]))),128))])])):_("",!0),u(tt,{modelValue:e(f),"onUpdate:modelValue":l[4]||(l[4]=r=>re(f)?f.value=r:null),"file-list":e(W),"onUpdate:fileList":l[5]||(l[5]=r=>re(W)?W.value=r:null),"is-loading":e(pe),placeholder:e(C)("ai-chat.frontend.and",{name:e(s).name}),attachmentSizeLimit:e(V)?.attachmentSizeLimit,class:"sticky bottom-0 z-10 [view-transition-name:chat-prompt]",rows:1,onStop:e(qe),onSubmit:le},{"panel-right-item":p(()=>[(e(s).billingConfig?.price??0)>0?(n(),m("span",Na,x(e(C)("ai-chat.frontend.singleRunConsumption",{price:e(s).billingConfig?.price??0})),1)):_("",!0)]),_:1},8,["modelValue","file-list","is-loading","placeholder","attachmentSizeLimit","onStop"])])],64)):_("",!0)],2)],2)}}});export{us as _};

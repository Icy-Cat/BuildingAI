import{u as Ze,J as Ie,K as Xe,L as et,d as ue,g as H,c as y,m as e,n as j,l as O,t as D,k as me,z as Ve,o as m,q as Z,f as I,w as se,G as tt,j as ge,T as ot,_ as xe,F as Y,B as J,x as K,v as de,i as Te,D as W,cU as De,a as Fe,cV as pe,cH as ie,bI as _e,p as $,cW as Ae,A as Ne}from"#entry";import st from"./-aacq5Xj.js";import{_ as nt}from"./B19A1O9i.js";import{s as lt}from"./BzLCLO6P.js";import{b as rt}from"./B1XcE43x.js";function at(a={}){return Ze("/user-schedule",a)}function it(a){return Ie("/user-schedule",a)}function Ee(a,N){return Xe(`/user-schedule/${a}`,N)}function dt(a){return et(`/user-schedule/${a}`)}function Pe(a){return Ie("/user-schedule/parse",a)}function ut(a){return Ie("/user-schedule/execute",a)}const ct={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm"},gt={class:"mb-3 flex items-start justify-between"},mt={class:"text-xs tracking-wide text-gray-500 uppercase"},pt={class:"text-base font-semibold text-gray-900"},ft={class:"space-y-2 text-sm text-gray-600"},yt={class:"grid grid-cols-3 gap-2"},vt={class:"col-span-2 font-medium"},bt={class:"grid grid-cols-3 gap-2"},xt={class:"col-span-2 font-medium"},ht={key:0,class:"grid grid-cols-3 gap-2"},wt={class:"col-span-2 font-medium"},Dt={key:1,class:"grid grid-cols-3 gap-2"},$t={class:"col-span-2 font-medium"},kt={class:"grid grid-cols-3 gap-2"},It={class:"col-span-2"},Tt={class:"rounded-md bg-gray-100 px-2 py-0.5 text-xs"},Ut={key:0,class:"mt-3 rounded-md bg-amber-50 p-3 text-xs text-amber-800"},St={key:0},Ct={class:"mt-4 flex items-center gap-2 text-sm"},Be=ue({__name:"ScheduleCard",props:{proposal:{},pending:{type:Boolean}},emits:["confirm","edit","cancel"],setup(a,{emit:N}){const r=a,u=H(()=>(r.proposal.missingFields??[]).length>0),_=N,v=C=>{if(!C)return"-";const w=new Date(C);return Number.isNaN(w.getTime())?C:new Intl.DateTimeFormat("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(w)},p=C=>C==="delete"?"error":C==="update"?"warning":C==="query"?"info":"primary",U={create:"åˆ›å»º",update:"æ›´æ–°",delete:"åˆ é™¤",query:"æŸ¥è¯¢"},h={high:"é«˜",medium:"ä¸­",low:"ä½",none:"æ— "},A=C=>h[C??"none"]??h.none;return(C,w)=>{const z=nt,F=Ve;return m(),y("div",ct,[e("div",gt,[e("div",null,[e("p",mt,D(a.proposal.intent==="create"?"åˆ›å»ºææ¡ˆ":"æ—¥ç¨‹ææ¡ˆ"),1),e("p",pt,D(a.proposal.data.title||a.proposal.summary),1)]),O(z,{color:p(a.proposal.intent),size:"xs"},{default:me(()=>[Z(D(U[a.proposal.intent]),1)]),_:1},8,["color"])]),e("dl",ft,[e("div",yt,[w[3]||(w[3]=e("dt",{class:"col-span-1 text-gray-500"},"å¼€å§‹æ—¶é—´",-1)),e("dd",vt,D(v(a.proposal.data.startTime)),1)]),e("div",bt,[w[4]||(w[4]=e("dt",{class:"col-span-1 text-gray-500"},"ç»“æŸæ—¶é—´",-1)),e("dd",xt,D(v(a.proposal.data.endTime)),1)]),a.proposal.data.location?(m(),y("div",ht,[w[5]||(w[5]=e("dt",{class:"col-span-1 text-gray-500"},"åœ°ç‚¹",-1)),e("dd",wt,D(a.proposal.data.location),1)])):j("",!0),a.proposal.data.attendees?(m(),y("div",Dt,[w[6]||(w[6]=e("dt",{class:"col-span-1 text-gray-500"},"å‚ä¸è€…",-1)),e("dd",$t,D(a.proposal.data.attendees),1)])):j("",!0),e("div",kt,[w[7]||(w[7]=e("dt",{class:"col-span-1 text-gray-500"},"ä¼˜å…ˆçº§",-1)),e("dd",It,[e("span",Tt,D(A(a.proposal.data.priority)),1)])])]),a.proposal.followUpQuestion||(a.proposal.missingFields?.length??0)>0?(m(),y("div",Ut,[e("div",null,D(a.proposal.followUpQuestion),1),a.proposal.missingFields?.length?(m(),y("div",St," ä»ç¼ºå°‘ï¼š"+D(a.proposal.missingFields.join("ï¼Œ")),1)):j("",!0)])):j("",!0),e("div",Ct,[O(F,{size:"xs",color:"primary",loading:a.pending,disabled:a.pending||u.value,onClick:w[0]||(w[0]=d=>_("confirm"))},{default:me(()=>[...w[8]||(w[8]=[Z(" ç¡®è®¤ ",-1)])]),_:1},8,["loading","disabled"]),O(F,{size:"xs",variant:"soft",color:"neutral",onClick:w[1]||(w[1]=d=>_("edit"))},{default:me(()=>[...w[9]||(w[9]=[Z("ç¼–è¾‘",-1)])]),_:1}),O(F,{size:"xs",variant:"ghost",color:"neutral",onClick:w[2]||(w[2]=d=>_("cancel"))},{default:me(()=>[...w[10]||(w[10]=[Z(" å–æ¶ˆ ",-1)])]),_:1})])])}}}),_t={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},At={class:"flex h-full w-full max-w-2xl flex-col overflow-hidden rounded-xl bg-white"},Nt={class:"flex items-center justify-between border-b px-5 py-3"},Et={class:"flex items-center gap-2"},Mt={key:1,class:"rounded-md bg-red-50 px-3 py-2 text-sm text-red-700"},Ot={class:"border-t bg-white p-4"},zt={class:"mt-2 text-xs text-gray-400"},Vt=ue({__name:"AIChatWidget",props:{open:{type:Boolean},modelId:{},timezone:{}},emits:["update:open","event-created","event-updated","event-deleted","query-result","edit-proposal"],setup(a,{emit:N}){const r=a,u=N,_=I([{id:crypto.randomUUID(),role:"assistant",content:"æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„ AI æ—¥ç¨‹åŠ©æ‰‹ã€‚å‘Šè¯‰æˆ‘æ‚¨æƒ³å®‰æ’æˆ–æŸ¥è¯¢çš„äº‹æƒ…å§ï½",timestamp:Date.now()}]),v=I(""),p=I(!1),U=I(!1),h=I(null),A=I(null),C=I(null);se(()=>r.open,async i=>{i?(await tt(),z()):(v.value="",h.value=null)}),se(_,()=>z(),{deep:!0});const w=H(()=>r.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),z=()=>{const i=C.value;i&&requestAnimationFrame(()=>{const l=C.value??i;l.scrollTop=l.scrollHeight})},F=async()=>{const i=v.value.trim();if(!(!i||p.value)){A.value=null,q("user",i),v.value="",p.value=!0;try{const l=await Pe({message:i,timezone:w.value,modelId:r.modelId});d(l)}catch(l){console.error("AI schedule parse failed",l),q("assistant","æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{p.value=!1}}},d=i=>{Q(i.reply),h.value=i.proposal??null,i.requiresClarification&&i.followUpQuestion&&q("assistant",i.followUpQuestion)},f=async()=>{if(!h.value||U.value)return;const i=h.value,l={intent:i.intent,scheduleId:i.originalEventId,data:i.data,summary:i.summary};U.value=!0,A.value=null;try{const k=await ut(l);L(k.intent,k.event,k.events),Q(k.message),h.value=null}catch(k){A.value="æ‰§è¡Œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚",console.error("Execute schedule failed",k)}finally{U.value=!1}},L=(i,l,k)=>{i==="create"&&l?u("event-created",l):i==="update"&&l?u("event-updated",l):i==="delete"&&l?u("event-deleted",l.id):i==="query"&&k&&u("query-result",k)},P=()=>{h.value=null},M=()=>{h.value&&(u("edit-proposal",h.value),h.value=null)},q=(i,l)=>{_.value.push({id:crypto.randomUUID(),role:i,content:l,timestamp:Date.now()})},Q=i=>{if(!i){q("assistant","");return}const l={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};_.value.push(l);let k=0;const c=lt(()=>{l.content+=i[k]??"",k+=1,k>=i.length&&clearInterval(c)},25)};return(i,l)=>{const k=xe,c=Ve,n=st;return m(),ge(ot,{name:"fade"},{default:me(()=>[a.open?(m(),y("div",_t,[e("div",At,[e("header",Nt,[e("div",Et,[O(k,{name:"i-lucide-bot",class:"text-blue-600"}),l[2]||(l[2]=e("div",null,[e("p",{class:"text-sm font-semibold"},"AI æ—¥ç¨‹åŠ©æ‰‹"),e("p",{class:"text-xs text-gray-500"},"è‡ªåŠ¨è¯†åˆ«æ„å›¾ä¸æ‹Ÿå®šæ—¥ç¨‹")],-1))]),O(c,{icon:"i-lucide-x",size:"xs",color:"neutral",variant:"ghost",onClick:l[0]||(l[0]=t=>u("update:open",!1))})]),e("div",{ref_key:"containerRef",ref:C,class:"flex-1 space-y-4 overflow-y-auto bg-gray-50 px-4 py-5"},[(m(!0),y(Y,null,J(_.value,t=>(m(),y("div",{key:t.id,class:K(["flex",t.role==="user"?"justify-end":"justify-start"])},[e("div",{class:K(["max-w-[80%] rounded-2xl px-3 py-2 text-sm",t.role==="user"?"rounded-br-none bg-blue-600 text-white":"rounded-bl-none bg-white text-gray-800 shadow"])},D(t.content),3)],2))),128)),h.value?(m(),ge(Be,{key:0,proposal:h.value,pending:U.value,onConfirm:f,onCancel:P,onEdit:M},null,8,["proposal","pending"])):j("",!0),A.value?(m(),y("div",Mt,D(A.value),1)):j("",!0)],512),e("footer",Ot,[e("form",{class:"flex gap-3",onSubmit:de(F,["prevent"])},[O(n,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=t=>v.value=t),placeholder:"ä¾‹å¦‚ï¼šæ˜å¤©ä¸‹åˆ3ç‚¹å’Œå°ç‹å¼€ä¸ªä¼š",disabled:p.value,class:"flex-1"},null,8,["modelValue","disabled"]),O(c,{type:"submit",color:"primary",loading:p.value,disabled:!v.value.trim()},{default:me(()=>[...l[3]||(l[3]=[Z(" å‘é€ ",-1)])]),_:1},8,["loading","disabled"])],32),e("p",zt,"æ—¶åŒºï¼š"+D(w.value),1)])])])):j("",!0)]),_:1})}}}),ve=(a=0,N=0)=>{const r=new Date;r.setMonth(r.getMonth()+a),r.setDate(r.getDate()+N);const u=r.getFullYear(),_=String(r.getMonth()+1).padStart(2,"0"),v=String(r.getDate()).padStart(2,"0");return`${u}-${_}-${v}`},oe=a=>{const N=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");return`${N}-${r}-${u}`},be=a=>{const[N,r,u]=a.split("-");return new Date(Number(N),Number(r)-1,Number(u))},Ft={work:"ğŸ’¼",personal:"ğŸ‘¤",meeting:"ğŸ¤",reminder:"â°",uncategorized:"ğŸ“"},Pt={class:"group relative rounded-lg border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-400 transition hover:border-blue-200 hover:bg-blue-50/40"},Bt={class:"pointer-events-none absolute inset-0 flex items-center justify-center gap-4 opacity-0 transition group-hover:opacity-100"},jt=ue({__name:"empty-hover-actions",props:{message:{},createLabel:{},aiLabel:{}},emits:["create","openAi"],setup(a,{emit:N}){const r=a,u=N;return(_,v)=>(m(),y("div",Pt,[Z(D(r.message||"è¿˜æ²¡æœ‰æ—¥ç¨‹")+" ",1),e("div",Bt,[e("button",{class:"pointer-events-auto rounded-full bg-blue-600 px-4 py-2 text-xs font-semibold text-white shadow hover:bg-blue-700",onClick:v[0]||(v[0]=de(p=>u("create"),["stop"]))},D(r.createLabel||"æ–°å»ºæ—¥ç¨‹"),1),e("button",{class:"pointer-events-auto rounded-full bg-purple-600 px-4 py-2 text-xs font-semibold text-white shadow hover:bg-purple-700",onClick:v[1]||(v[1]=de(p=>u("openAi"),["stop"]))},D(r.aiLabel||"AIå†™å¾…åŠ"),1)])]))}}),Lt={key:0,class:"mb-4 flex flex-wrap items-center gap-3"},Rt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},Wt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},qt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},Gt={key:0},Kt={key:1,class:"space-y-4"},Qt={class:"flex items-center gap-2 text-sm font-semibold text-gray-800"},Ht={class:"space-y-1.5"},Yt=["onDblclick"],Jt=["onClick","title"],Zt={class:"flex min-w-0 flex-1 flex-col"},Xt={class:"relative min-h-[32px]"},eo=["id","onKeydown","onBlur"],to={class:"mt-0.5 text-xs text-gray-500"},oo={class:"flex items-center gap-2 text-xs text-gray-500"},so={key:0,class:"rounded-full border border-red-200 px-2 py-0.5 text-red-600"},no={key:1,class:"rounded-full border border-orange-200 px-2 py-0.5 text-orange-600"},lo=["onClick"],ro=["onClick","disabled"],Me="schedule:list-view-prefs",Ue=ue({__name:"list-view",props:{selectedDate:{},scheduleItems:{},deletingId:{},variant:{},sortBy:{},showCompleted:{type:Boolean,default:void 0}},emits:["toggleComplete","toggleImportant","toggleUrgent","edit","delete","create","openAi","updateTitle"],setup(a,{emit:N}){const r=a,u=N,_=I(r.sortBy??"time"),v=I("asc"),p=I("all"),U=I(!0),h=I(!1),A=I(!1),C=()=>{if(!(typeof window>"u"))try{const n=window.localStorage.getItem(Me);if(!n)return;const t=JSON.parse(n);t.sortBy&&(_.value=t.sortBy),t.sortOrder&&(v.value=t.sortOrder),t.filter&&(p.value=t.filter),typeof t.showCompleted=="boolean"&&(U.value=t.showCompleted),typeof t.importantOnly=="boolean"&&(h.value=t.importantOnly),typeof t.urgentOnly=="boolean"&&(A.value=t.urgentOnly)}catch(n){console.warn("Failed to restore list prefs",n)}},w=()=>{if(typeof window>"u")return;const n={sortBy:_.value,sortOrder:v.value,filter:p.value,showCompleted:U.value,importantOnly:h.value,urgentOnly:A.value};window.localStorage.setItem(Me,JSON.stringify(n))};Te(()=>{C()}),se([_,v,p,U,h,A],w,{deep:!1});const z=H(()=>r.sortBy??_.value),F=H(()=>r.showCompleted??U.value),d=H(()=>r.scheduleItems.filter(n=>!(p.value!=="all"&&n.category!==p.value||!F.value&&n.completed||h.value&&!n.isImportant||A.value&&!n.isUrgent))),f=H(()=>L(d.value)),L=n=>{const t=[...n],S=v.value==="asc"?1:-1,g=G=>{const[T="00",R="00"]=(G.time||"00:00").split(":");return Number(T)*60+Number(R)};if(z.value==="time")t.sort((G,T)=>(g(G)-g(T))*S);else{const G=T=>T==="high"?3:T==="medium"?2:T==="low"?1:0;t.sort((T,R)=>{const ne=T.isImportant?1:0,le=R.isImportant?1:0;if(ne!==le)return(le-ne)*S;const te=T.isUrgent?1:0,X=R.isUrgent?1:0;if(te!==X)return(X-te)*S;const re=G(String(R.priority))-G(String(T.priority));return re!==0?re*S:(g(T)-g(R))*S})}return t},P=H(()=>{const n=new Map;f.value.forEach(S=>{const g=n.get(S.date)??[];g.push(S),n.set(S.date,g)});const t=Array.from(n.keys()).sort((S,g)=>be(S).getTime()-be(g).getTime());return v.value==="desc"&&z.value==="time"&&t.reverse(),t.map(S=>[S,n.get(S)??[]])}),M=n=>be(n).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),q=I(null),Q=I(""),i=n=>{q.value=n.id,Q.value=n.title,requestAnimationFrame(()=>{const t=document.getElementById(`inline-input-${n.id}`);t?.focus(),t?.select()})},l=n=>{if(!q.value)return;const t=Q.value.trim();t&&t!==n.title&&u("updateTitle",{id:n.id,title:t}),q.value=null,Q.value=""},k=()=>{q.value=null,Q.value=""},c=()=>{v.value=v.value==="asc"?"desc":"asc"};return(n,t)=>{const S=xe;return m(),y("div",{class:K(["rounded-2xl bg-white p-2 shadow-lg",r.variant==="compact"?"rounded-none bg-transparent p-0 shadow-none":""])},[r.variant!=="compact"?(m(),y("div",Lt,[W(e("select",{"onUpdate:modelValue":t[0]||(t[0]=g=>_.value=g),class:"rounded-full border border-gray-200 px-3 py-1 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},[...t[8]||(t[8]=[e("option",{value:"time"},"æŒ‰æ—¶é—´æ’åº",-1),e("option",{value:"importance"},"æŒ‰é‡è¦æ€§æ’åº",-1)])],512),[[De,_.value]]),e("button",{type:"button",onClick:c,class:"inline-flex items-center gap-1 rounded-full border border-gray-200 px-3 py-1 text-sm text-gray-700 transition hover:border-blue-200 hover:text-blue-700"},[Z(D(v.value==="asc"?"é¡ºåº":"å€’åº")+" ",1),O(S,{name:v.value==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-narrow-wide",class:"h-4 w-4"},null,8,["name"])]),W(e("select",{"onUpdate:modelValue":t[1]||(t[1]=g=>p.value=g),class:"rounded-full border border-gray-200 px-3 py-1 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},[...t[9]||(t[9]=[Fe('<option value="all">æ‰€æœ‰ç±»åˆ«</option><option value="work">å·¥ä½œ</option><option value="personal">ä¸ªäºº</option><option value="meeting">ä¼šè®®</option><option value="reminder">æé†’</option><option value="uncategorized">æœªåˆ†ç±»</option>',6)])],512),[[De,p.value]]),e("label",Rt,[W(e("input",{"onUpdate:modelValue":t[2]||(t[2]=g=>U.value=g),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,U.value]]),t[10]||(t[10]=Z(" æ˜¾ç¤ºå·²å®Œæˆ ",-1))]),e("label",Wt,[W(e("input",{"onUpdate:modelValue":t[3]||(t[3]=g=>h.value=g),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,h.value]]),t[11]||(t[11]=Z(" åªçœ‹é‡è¦ ",-1))]),e("label",qt,[W(e("input",{"onUpdate:modelValue":t[4]||(t[4]=g=>A.value=g),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,A.value]]),t[12]||(t[12]=Z(" åªçœ‹ç´§æ€¥ ",-1))])])):j("",!0),e("div",{class:K(["rounded-2xl border border-gray-100 bg-white p-4 shadow-sm",r.variant==="compact"?"border-none bg-transparent p-0 shadow-none":""])},[P.value.length===0?(m(),y("div",Gt,[O(jt,{message:"æš‚æ— å®‰æ’",onCreate:t[5]||(t[5]=g=>u("create")),onOpenAi:t[6]||(t[6]=g=>u("openAi"))})])):(m(),y("div",Kt,[(m(!0),y(Y,null,J(P.value,([g,G])=>(m(),y("div",{key:g,class:"space-y-2"},[e("div",Qt,[t[13]||(t[13]=e("span",{class:"h-2 w-2 rounded-full bg-blue-500"},null,-1)),e("span",null,D(M(g)),1)]),e("div",Ht,[(m(!0),y(Y,null,J(G,T=>(m(),y("div",{key:T.id,class:"flex items-center gap-2 rounded-xl px-2 py-1 hover:bg-gray-50",onDblclick:R=>i(T)},[e("button",{class:K(["flex h-4 w-4 items-center justify-center rounded-full border border-blue-400 text-blue-500 transition hover:bg-blue-50",T.completed?"bg-blue-500 text-white":""]),onClick:R=>u("toggleComplete",T.id),title:T.completed?"æ ‡è®°æœªå®Œæˆ":"æ ‡è®°å®Œæˆ"},[T.completed?(m(),ge(S,{key:0,name:"i-lucide-check",class:"h-3 w-3"})):j("",!0)],10,Jt),e("div",Zt,[e("div",Xt,[e("div",{class:K(["text-sm transition-colors",[T.completed?"text-gray-400 line-through":"text-gray-900",q.value===T.id?"invisible":""]])},D(T.title),3),q.value===T.id?W((m(),y("input",{key:0,id:`inline-input-${T.id}`,"onUpdate:modelValue":t[7]||(t[7]=R=>Q.value=R),class:"absolute top-0 left-0 h-8 w-full rounded border border-blue-300 bg-white px-2 text-sm leading-tight shadow-sm focus:border-blue-400 focus:ring-2 focus:ring-blue-100 focus:outline-none",onKeydown:[_e(de(R=>l(T),["stop","prevent"]),["enter"]),_e(de(k,["stop","prevent"]),["esc"])],onBlur:R=>l(T)},null,40,eo)),[[ie,Q.value]]):j("",!0)]),e("div",to,D(T.time||"--:--")+" Â· "+D($(Ft)[T.category]),1)]),e("div",oo,[T.isImportant?(m(),y("span",so," é‡ ")):j("",!0),T.isUrgent?(m(),y("span",no," æ€¥ ")):j("",!0),e("button",{onClick:R=>u("edit",T),class:"rounded-full p-1 text-blue-600 transition hover:bg-blue-50"},[O(S,{name:"i-lucide-edit",class:"h-4 w-4"})],8,lo),e("button",{onClick:R=>u("delete",T.id),class:"rounded-full p-1 text-red-600 transition hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:a.deletingId===T.id},[O(S,{name:"i-lucide-trash",class:"h-4 w-4"})],8,ro)])],40,Yt))),128))])]))),128))]))],2)],2)}}}),ao={class:"rounded-2xl bg-white p-6 shadow-lg"},io={class:"mb-6 flex flex-wrap items-center justify-between gap-3"},uo={class:"text-xl font-semibold text-gray-900"},co={class:"mt-2 flex items-center gap-2 text-xs text-gray-500"},go={class:"flex items-center gap-2"},mo={class:"flex rounded-full bg-gray-100 p-1 text-sm"},po=["onClick"],fo={key:0,class:"space-y-3"},yo={class:"grid grid-cols-7 gap-2 text-center text-xs font-semibold text-gray-500"},vo={class:"grid grid-cols-7 gap-2"},bo=["onClick"],xo={class:"flex items-center justify-between"},ho={class:"text-sm font-semibold"},wo={key:0,class:"rounded-full bg-blue-100 px-1 text-[10px] font-semibold text-blue-700"},Do={class:"mt-1 space-y-1"},$o=["onClick"],ko={key:1,class:"space-y-3"},Io={class:"relative rounded-xl border border-gray-100 bg-gray-50 p-3"},To={class:"grid grid-cols-7 gap-3"},Uo=["onClick"],So={class:"text-[13px] font-semibold"},Co={class:"text-lg leading-tight font-bold"},_o={class:"grid grid-cols-7 gap-3"},Ao={class:"flex-1 space-y-2"},No={key:0,class:"rounded-lg border border-dashed border-gray-200 px-2 py-4 text-center text-xs text-gray-400"},Eo={class:"flex items-center justify-between font-semibold"},Mo={class:"truncate"},Oo=["onClick"],zo={class:"mt-1 text-[11px] text-gray-700"},Vo={key:2,class:"space-y-4"},Fo={class:"flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50 p-3"},Po={class:"flex w-full items-center gap-3"},Bo={class:"grid flex-1 grid-cols-7 gap-3"},jo=["onClick"],Lo={class:"text-[13px] font-semibold"},Ro={class:"text-lg leading-tight font-bold"},Wo=ue({__name:"calendar-view",props:{currentDate:{},selectedDate:{},scheduleItems:{},mode:{},loading:{type:Boolean},deletingId:{}},emits:["update:selectedDate","update:currentDate","change-mode","create","edit","open-ai","toggle-complete","toggle-important","toggle-urgent","delete","update-title"],setup(a,{emit:N}){const r=a,u=N,_=["å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­","å‘¨æ—¥"],v=H(()=>z(r.currentDate)),p=H(()=>F(r.selectedDate)),U=i=>[...i].sort((l,k)=>(l.time||"00:00").localeCompare(k.time||"00:00")),h=H(()=>U(d(r.selectedDate))),A=H(()=>{if(r.mode==="day")return r.selectedDate.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"});if(r.mode==="week"){const i=p.value,l=i[0],k=i[i.length-1];return!l||!k?"":`${l.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})} - ${k.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})}`}return`${r.currentDate.getFullYear()} å¹´ ${r.currentDate.getMonth()+1} æœˆ`}),C=[{key:"day",label:"æ—¥"},{key:"week",label:"å‘¨"},{key:"month",label:"æœˆ"}],w=i=>{const l=new Date(i),k=l.getDay(),c=k===0?-6:1-k;return l.setDate(l.getDate()+c),l.setHours(0,0,0,0),l},z=i=>{const l=i.getFullYear(),k=i.getMonth(),c=new Date(l,k,1),n=new Date(c),t=(c.getDay()+6)%7;n.setDate(n.getDate()-t);const S=[];for(let g=0;g<42;g++){const G=new Date(n);G.setDate(n.getDate()+g),S.push(G)}return S},F=i=>{const l=w(i);return Array.from({length:7},(k,c)=>{const n=new Date(l);return n.setDate(l.getDate()+c),n})},d=i=>{const l=oe(i);return r.scheduleItems.filter(k=>k.date===l)},f=i=>{u("update:selectedDate",i),u("update:currentDate",i)},L=i=>{const l=new Date(r.selectedDate);r.mode==="day"?l.setDate(l.getDate()+i):r.mode==="week"?l.setDate(l.getDate()+i*7):(l.setMonth(l.getMonth()+i),l.setDate(1)),f(l)},P=()=>{f(new Date)},M=()=>{const i=new Date(r.selectedDate);i.setDate(i.getDate()-7),f(i)},q=()=>{const i=new Date(r.selectedDate);i.setDate(i.getDate()+7),f(i)},Q=i=>i.toDateString()===new Date().toDateString();return(i,l)=>{const k=xe;return m(),y("div",ao,[e("div",io,[e("div",null,[e("h3",uo,D(A.value),1),e("div",co,[e("button",{onClick:l[0]||(l[0]=c=>L(-1)),class:"rounded-full border border-gray-200 px-3 py-1 transition hover:bg-gray-50"}," ä¸Šä¸€"+D(a.mode==="month"?"æœˆ":a.mode==="week"?"å‘¨":"å¤©"),1),e("button",{onClick:P,class:"rounded-full bg-blue-600 px-3 py-1.5 text-white shadow hover:bg-blue-700"}," ä»Šå¤© "),e("button",{onClick:l[1]||(l[1]=c=>L(1)),class:"rounded-full border border-gray-200 px-3 py-1 transition hover:bg-gray-50"}," ä¸‹ä¸€"+D(a.mode==="month"?"æœˆ":a.mode==="week"?"å‘¨":"å¤©"),1)])]),e("div",go,[e("div",mo,[(m(),y(Y,null,J(C,c=>e("button",{key:c.key,onClick:n=>u("change-mode",c.key),class:K(["rounded-full px-4 py-1.5 transition",a.mode===c.key?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"])},D(c.label),11,po)),64))])])]),a.mode==="month"?(m(),y("div",fo,[e("div",yo,[(m(),y(Y,null,J(_,c=>e("div",{key:c},D(c),1)),64))]),e("div",vo,[(m(!0),y(Y,null,J(v.value,(c,n)=>(m(),y("div",{key:n,onClick:t=>f(c),class:K(["group relative h-24 cursor-pointer rounded-xl border border-transparent bg-gray-50 p-2 text-left transition hover:border-blue-100 hover:bg-white",[c.getMonth()===a.currentDate.getMonth()?"text-gray-900":"text-gray-400",Q(c)?"border-blue-200 bg-blue-50":"",c.toDateString()===a.selectedDate.toDateString()?"ring-2 ring-blue-500":""]])},[e("div",xo,[e("span",ho,D(c.getDate()),1),d(c).length>1?(m(),y("span",wo," +"+D(d(c).length-1),1)):j("",!0)]),e("div",Do,[(m(!0),y(Y,null,J(d(c).slice(0,2),t=>(m(),y("div",{key:t.id,class:K(["w-full truncate rounded-md px-1 py-0.5 text-[10px]",t.completed?"bg-gray-200 text-gray-600 line-through":"bg-blue-100 text-blue-800"])},D(t.title),3))),128))]),c.toDateString()===a.selectedDate.toDateString()?(m(),y("button",{key:0,onClick:de(t=>u("create",c),["stop"]),title:"æ·»åŠ æ—¥ç¨‹",class:"absolute right-2 bottom-2 flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white opacity-0 shadow-lg transition group-hover:opacity-100"},[O(k,{name:"i-lucide-plus",class:"h-4 w-4"})],8,$o)):j("",!0)],10,bo))),128))])])):a.mode==="week"?(m(),y("div",ko,[e("div",Io,[e("div",To,[(m(!0),y(Y,null,J(p.value,(c,n)=>(m(),y("button",{key:n,onClick:t=>f(c),class:K(["flex flex-col items-center rounded-lg px-3 py-2 text-xs transition",[c.toDateString()===a.selectedDate.toDateString()?"bg-blue-600 text-white shadow":"text-gray-700 hover:bg-gray-100"]])},[e("span",So,D(_[n]),1),e("span",Co,D(c.getDate()),1)],10,Uo))),128))]),e("button",{onClick:M,class:"absolute top-1/2 -left-6 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-gray-200 text-gray-600 shadow-sm transition hover:bg-gray-50"},[O(k,{name:"i-lucide-chevron-left",class:"h-5 w-5"})]),e("button",{onClick:q,class:"absolute top-1/2 -right-6 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-gray-200 text-gray-600 shadow-sm transition hover:bg-gray-50"},[O(k,{name:"i-lucide-chevron-right",class:"h-5 w-5"})])]),e("div",_o,[(m(!0),y(Y,null,J(p.value,(c,n)=>(m(),y("div",{key:n,class:"flex min-h-[360px] flex-col rounded-xl border border-gray-100 bg-white/70 p-3 shadow-sm"},[e("div",Ao,[d(c).length===0?(m(),y("div",No," æš‚æ— å®‰æ’ ")):(m(!0),y(Y,{key:1},J(U(d(c)),t=>(m(),y("div",{key:t.id,class:"rounded-lg bg-amber-200/80 px-2 py-1 text-xs text-gray-800 shadow"},[e("div",Eo,[e("span",Mo,D(t.title),1),e("button",{class:"text-blue-700 hover:text-blue-900",onClick:S=>u("edit",t)},[O(k,{name:"i-lucide-edit",class:"h-4 w-4"})],8,Oo)]),e("div",zo,D(t.time),1)]))),128))])]))),128))])])):(m(),y("div",Vo,[e("div",Fo,[e("div",Po,[e("button",{onClick:M,class:"flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 transition hover:bg-gray-50"},[O(k,{name:"i-lucide-chevron-left",class:"h-5 w-5"})]),e("div",Bo,[(m(!0),y(Y,null,J(p.value,(c,n)=>(m(),y("button",{key:n,onClick:t=>f(c),class:K(["flex flex-col items-center rounded-lg px-3 py-2 text-xs transition",[c.toDateString()===a.selectedDate.toDateString()?"bg-blue-600 text-white shadow":"text-gray-700 hover:bg-gray-100"]])},[e("span",Lo,D(_[n]),1),e("span",Ro,D(c.getDate()),1)],10,jo))),128))]),e("button",{onClick:q,class:"flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 transition hover:bg-gray-50"},[O(k,{name:"i-lucide-chevron-right",class:"h-5 w-5"})])])]),O(Ue,{"selected-date":a.selectedDate,"schedule-items":h.value,"deleting-id":r.deletingId??null,onCreate:l[2]||(l[2]=c=>u("create",a.selectedDate)),onOpenAi:l[3]||(l[3]=c=>u("open-ai")),onToggleComplete:l[4]||(l[4]=c=>u("toggle-complete",c)),onToggleImportant:l[5]||(l[5]=c=>u("toggle-important",c)),onToggleUrgent:l[6]||(l[6]=c=>u("toggle-urgent",c)),onUpdateTitle:l[7]||(l[7]=c=>u("update-title",c)),onEdit:l[8]||(l[8]=c=>u("edit",c)),onDelete:l[9]||(l[9]=c=>u("delete",c))},null,8,["selected-date","schedule-items","deleting-id"])]))])}}}),qo={class:"flex min-h-0 flex-col rounded-2xl border border-gray-200 bg-white p-5 text-gray-900 shadow-sm",style:{"min-height":"calc(100vh - 220px)"}},Go={class:"mb-4 flex items-center justify-between gap-3"},Ko=["value"],Qo={class:"grid min-h-0 flex-1 auto-rows-fr grid-cols-1 divide-y divide-gray-200 md:grid-cols-2 md:divide-x md:divide-y-0"},Ho={class:"mb-3 flex items-center justify-between"},Yo={class:"flex items-center gap-2"},Jo={class:"group relative"},Zo={class:"invisible absolute top-full right-0 z-10 mt-1 w-28 rounded-lg border border-gray-200 bg-white p-2 text-[12px] text-gray-800 opacity-0 shadow-lg transition group-hover:visible group-hover:opacity-100"},Xo={class:"flex cursor-pointer items-center gap-2"},es={class:"mt-1 flex cursor-pointer items-center gap-2"},ts={class:"flex-1 overflow-auto pr-1 text-gray-900"},Oe="schedule:quadrant-sort",os=ue({__name:"quadrant-view",props:{selectedDate:{},scheduleItems:{},deletingId:{},dailyGoal:{}},emits:["update:dailyGoal","toggleComplete","toggleImportant","toggleUrgent","edit","delete","create","openAi","updateTitle"],setup(a,{emit:N}){const r=a,u=N,_=d=>d==="high",v=d=>d==="high"||d==="medium",p=H(()=>({IU:r.scheduleItems.filter(d=>(d.isImportant??_(d.priority))&&(d.isUrgent??!1)),IN:r.scheduleItems.filter(d=>(d.isImportant??v(d.priority))&&!(d.isUrgent??!1)),NU:r.scheduleItems.filter(d=>!(d.isImportant??!1)&&(d.isUrgent??!1)),NN:r.scheduleItems.filter(d=>!(d.isImportant??!1)&&!(d.isUrgent??!1))})),U=I("time"),h=()=>{if(!(typeof window>"u"))try{const d=window.localStorage.getItem(Oe);if(!d)return;const f=JSON.parse(d);f.sortMode&&(U.value=f.sortMode)}catch(d){console.warn("Failed to restore quadrant prefs",d)}},A=()=>{typeof window>"u"||window.localStorage.setItem(Oe,JSON.stringify({sortMode:U.value}))};Te(()=>{h()}),se(U,A);const C=d=>{const[f="00",L="00"]=(d.time||"00:00").split(":");return Number(f)*60+Number(L)},w=d=>d.isImportant?3:d.priority==="high"?2:d.priority==="medium"?1:0,z=d=>{const f=[...d];return U.value==="time"?f.sort((L,P)=>C(L)-C(P)):f.sort((L,P)=>w(P)-w(L)),f},F=d=>z(p.value[d]);return(d,f)=>{const L=xe;return m(),y("div",qo,[e("div",Go,[f[12]||(f[12]=e("h3",{class:"text-lg font-semibold text-gray-900"},"å››è±¡é™è§†å›¾",-1)),e("input",{type:"text",value:a.dailyGoal,onInput:f[0]||(f[0]=P=>u("update:dailyGoal",P.target.value)),placeholder:"å½“æ—¥ç›®æ ‡...",class:"w-64 rounded-full border border-gray-200 px-3 py-1.5 text-xs placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},null,40,Ko)]),e("div",Qo,[(m(),y(Y,null,J([{key:"IU",title:"é‡è¦ä¸”ç´§æ€¥",color:"text-red-600"},{key:"IN",title:"é‡è¦ä¸ç´§æ€¥",color:"text-amber-600"},{key:"NU",title:"ä¸é‡è¦ä½†ç´§æ€¥",color:"text-emerald-600"},{key:"NN",title:"ä¸é‡è¦ä¸ç´§æ€¥",color:"text-gray-800"}],P=>e("div",{key:P.key,class:"flex h-full min-h-0 flex-col border border-gray-200 bg-white p-4 text-sm"},[e("div",Ho,[e("div",{class:K(["font-semibold",P.color])},D(P.title)+" ("+D(p.value[P.key].length)+") ",3),e("div",Yo,[e("button",{onClick:f[1]||(f[1]=M=>u("create")),class:"flex h-7 w-7 items-center justify-center rounded-full border border-gray-200 text-gray-600 hover:bg-gray-100",title:"æ–°å»ºæ—¥ç¨‹"},[O(L,{name:"i-lucide-plus",class:"h-4 w-4"})]),e("div",Jo,[f[15]||(f[15]=e("button",{class:"rounded-full border border-gray-200 px-2 py-1 text-xs text-gray-600 hover:bg-gray-100",title:"æ’åº"}," ... ",-1)),e("div",Zo,[e("label",Xo,[W(e("input",{type:"radio",value:"time","onUpdate:modelValue":f[2]||(f[2]=M=>U.value=M),class:"h-3 w-3"},null,512),[[Ae,U.value]]),f[13]||(f[13]=Z(" æŒ‰æ—¶é—´ ",-1))]),e("label",es,[W(e("input",{type:"radio",value:"importance","onUpdate:modelValue":f[3]||(f[3]=M=>U.value=M),class:"h-3 w-3"},null,512),[[Ae,U.value]]),f[14]||(f[14]=Z(" æŒ‰é‡è¦ç¨‹åº¦ ",-1))])])])])]),e("div",ts,[O(Ue,{variant:"compact","selected-date":a.selectedDate,"schedule-items":F(P.key),"deleting-id":a.deletingId,"sort-by":U.value,"show-completed":!0,onToggleComplete:f[4]||(f[4]=M=>u("toggleComplete",M)),onToggleImportant:f[5]||(f[5]=M=>u("toggleImportant",M)),onToggleUrgent:f[6]||(f[6]=M=>u("toggleUrgent",M)),onUpdateTitle:f[7]||(f[7]=M=>u("updateTitle",M)),onEdit:f[8]||(f[8]=M=>u("edit",M)),onDelete:f[9]||(f[9]=M=>u("delete",M)),onCreate:f[10]||(f[10]=M=>u("create")),onOpenAi:f[11]||(f[11]=M=>u("openAi"))},null,8,["selected-date","schedule-items","deleting-id","sort-by"])])])),64))])])}}}),ss={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},ns={class:"w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl"},ls={class:"mb-4 flex items-center justify-between"},rs={class:"flex flex-col gap-1"},as={class:"text-xs tracking-widest text-gray-400 uppercase"},is={class:"text-xl font-semibold text-gray-900"},ds={class:"flex items-center gap-3"},us={class:"flex cursor-pointer items-center gap-1 rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:border-blue-200 hover:text-blue-600"},cs={class:"space-y-4"},gs={class:"rounded-xl border border-dashed border-gray-200 p-4"},ms={key:0,class:"mt-4 space-y-4 border-t border-gray-100 pt-4"},ps={class:"grid gap-4 md:grid-cols-2"},fs={class:"flex items-center gap-2"},ys={class:"grid gap-4 md:grid-cols-2"},vs={class:"grid gap-3 md:grid-cols-2"},bs={class:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm"},xs={class:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm"},hs={key:0,class:"space-y-3"},ws={class:"flex justify-end gap-3"},Ds=["disabled"],$s=["disabled"],ks={key:1,class:"space-y-4"},Is={class:"rounded-xl border border-dashed border-blue-200 bg-blue-50/40 p-4"},Ts=["disabled"],Us=["disabled"],Ss={key:0,class:"rounded-lg bg-gray-50 px-3 py-2 text-sm text-gray-700"},Cs={key:1,class:"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800"},_s={key:2,class:"rounded-lg bg-red-50 px-3 py-2 text-sm text-red-700"},As={class:"flex justify-end"},Ns=ue({__name:"schedule-modal",props:{isOpen:{type:Boolean},editingItem:{},selectedDate:{},saving:{type:Boolean},startWithAi:{type:Boolean},modelId:{}},emits:["close","save"],setup(a,{emit:N}){const r=a,u=N,_=H(()=>Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),v=n=>{if(!n)return"09:00";const t=n.match(/(\d{1,2}):(\d{2})/);if(!t||!t[1]||!t[2])return"09:00";const S=t[1].padStart(2,"0"),g=t[2].padStart(2,"0");return`${S}:${g}`},p=I({title:"",description:"",date:"",time:"09:00",priority:"none",category:"uncategorized",completed:!1,isImportant:!1,isUrgent:!1,meetingAgenda:"",attendees:""}),U=I(!1),h=I(!1),A=I(""),C=I(!1),w=I(null),z=I(null),F=I(null),d=I(null);se(()=>[r.editingItem,r.selectedDate],()=>{if(r.editingItem){const{title:n,description:t,date:S,time:g,priority:G,category:T,completed:R,isImportant:ne,isUrgent:le,meetingAgenda:te,attendees:X}=r.editingItem;p.value={title:n,description:t,date:S||oe(r.selectedDate),time:v(g),priority:G,category:T,completed:R,isImportant:!!ne,isUrgent:!!le,meetingAgenda:te||"",attendees:X||""}}else p.value={title:"",description:"",date:oe(r.selectedDate),time:"09:00",priority:"none",category:"uncategorized",completed:!1,isImportant:!1,isUrgent:!1,meetingAgenda:"",attendees:""}},{immediate:!0}),se(()=>r.isOpen,n=>{n&&(h.value=!!r.startWithAi)},{immediate:!0}),se(h,n=>{n||(A.value="",z.value=null,F.value=null,d.value=null,w.value=null)});const f=()=>{u("save",{...p.value,time:v(p.value.time)})},L=n=>{if(!n)return"09:00";const t=new Date(n);return Number.isNaN(t.getTime())?"09:00":`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},P=n=>["work","personal","meeting","reminder","uncategorized"].includes(n)?n:"uncategorized",M=n=>["high","medium","low","none"].includes(n)?n:"none",q=n=>{const t=n.data.startTime?new Date(n.data.startTime):r.selectedDate,S=oe(t);return{title:n.data.title||n.summary||"",description:n.data.description||"",date:S,time:L(n.data.startTime)||"09:00",priority:M(n.data.priority),category:P(n.data.category),completed:n.data.completed??!1,isImportant:n.data.isImportant??!1,isUrgent:n.data.isUrgent??!1,meetingAgenda:"",attendees:n.data.attendees||""}},Q=async()=>{const n=A.value.trim();if(!(!n||C.value)){C.value=!0,w.value=null,z.value=null,F.value=null,d.value=null;try{const t=await Pe({message:n,timezone:_.value,modelId:r.modelId});z.value=t.reply,F.value=t.followUpQuestion||null,t.proposal?d.value=t.proposal:t.requiresClarification||(w.value="AI æœªèƒ½ç”Ÿæˆå¾…åŠï¼Œè¯·æ¢ä¸€ç§æè¿°å†è¯•ä¸€æ¬¡ã€‚")}catch(t){console.error("AI parse schedule failed",t),w.value="AI å†™å¾…åŠæš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚"}finally{C.value=!1,A.value=""}}},i=n=>{n.key==="Enter"&&(n.shiftKey||n.ctrlKey||n.metaKey||n.altKey||(n.preventDefault(),Q()))},l=()=>{if(!d.value)return;const n=q(d.value);u("save",n)},k=()=>{d.value=null},c=()=>{if(!d.value)return;const n=q(d.value);p.value=n,h.value=!1,U.value=!0};return(n,t)=>{const S=xe;return a.isOpen?(m(),y("div",ss,[e("div",ns,[e("div",ls,[e("div",rs,[e("p",as,D(a.editingItem?"ç¼–è¾‘æ—¥ç¨‹":"æ–°å»ºæ—¥ç¨‹"),1),e("h3",is,D($(p).title||"è¾“å…¥æ ‡é¢˜"),1)]),e("div",ds,[e("label",us,[W(e("input",{type:"checkbox",class:"sr-only","onUpdate:modelValue":t[0]||(t[0]=g=>Ne(h)?h.value=g:null),"aria-label":"AIå†™å¾…åŠ"},null,512),[[pe,$(h)]]),O(S,{name:"i-lucide-bot",class:K(["h-4 w-4",$(h)?"text-blue-600":"text-gray-400"])},null,8,["class"]),t[16]||(t[16]=e("span",null,"AIå†™å¾…åŠ",-1)),e("span",{class:K(["relative inline-flex h-4 w-7 items-center rounded-full transition",$(h)?"bg-blue-600":"bg-gray-300"])},[e("span",{class:K(["inline-block h-3 w-3 rounded-full bg-white transition",$(h)?"translate-x-3":"translate-x-0.5"])},null,2)],2)]),e("button",{class:"text-gray-400 transition hover:text-gray-600",type:"button",onClick:t[1]||(t[1]=g=>u("close"))},[O(S,{name:"i-lucide-x",class:"h-5 w-5"})])])]),$(h)?(m(),y("div",ks,[e("div",Is,[t[30]||(t[30]=e("p",{class:"text-sm font-medium text-blue-900"},"AI å†™å¾…åŠ",-1)),t[31]||(t[31]=e("p",{class:"text-xs text-blue-700"},"æè¿°ä½ æƒ³å®‰æ’çš„äº‹æƒ…ï¼ŒAI å°†å¸®ä½ ç”Ÿæˆå¾…åŠå¡ç‰‡ã€‚",-1)),e("form",{class:"mt-3 flex flex-col gap-3",onSubmit:de(Q,["prevent"])},[W(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=g=>Ne(A)?A.value=g:null),rows:"3",class:"w-full rounded-lg border border-blue-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"ä¾‹å¦‚ï¼šæ˜å¤©ä¸Šåˆ10ç‚¹å’Œé”€å”®å›¢é˜Ÿå¼€ä¼šï¼Œæ€»ç»“å‘¨æŠ¥",disabled:$(C),onKeydown:i,required:""},null,40,Ts),[[ie,$(A)]]),e("button",{type:"submit",class:"inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:$(C)||!$(A).trim()},[O(S,{name:"i-lucide-bot",class:"mr-1 h-4 w-4"}),Z(" "+D($(C)?"AI æ­£åœ¨ç”Ÿæˆ...":"AI å†™å¾…åŠ"),1)],8,Us)],32)]),$(z)?(m(),y("div",Ss,D($(z)),1)):j("",!0),$(F)?(m(),y("div",Cs,D($(F)),1)):j("",!0),$(w)?(m(),y("div",_s,D($(w)),1)):j("",!0),$(d)?(m(),ge(Be,{key:3,proposal:$(d),onConfirm:l,onCancel:k,onEdit:c},null,8,["proposal"])):j("",!0),e("div",As,[e("button",{type:"button",class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",onClick:t[15]||(t[15]=g=>u("close"))}," å…³é—­ ")])])):(m(),y("form",{key:0,onSubmit:de(f,["prevent"]),class:"space-y-6"},[e("div",cs,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ ‡é¢˜",-1)),W(e("input",{"onUpdate:modelValue":t[2]||(t[2]=g=>$(p).title=g),type:"text",placeholder:"è¾“å…¥æ—¥ç¨‹æ ‡é¢˜",class:"w-full rounded-lg border border-gray-200 px-3 py-2 text-base focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,$(p).title]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-600"},"å¤‡æ³¨",-1)),W(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=g=>$(p).description=g),rows:"3",placeholder:"æ·»åŠ æè¿°æˆ–èƒŒæ™¯ä¿¡æ¯...",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,$(p).description]])])]),e("div",gs,[e("button",{type:"button",class:"flex w-full items-center justify-between text-sm font-medium text-gray-600",onClick:t[4]||(t[4]=g=>U.value=!$(U))},[t[19]||(t[19]=e("span",null,"æ›´å¤šé€‰é¡¹",-1)),O(S,{name:"i-lucide-chevron-down",class:K(["h-4 w-4 transition",$(U)?"rotate-180":""])},null,8,["class"])]),$(U)?(m(),y("div",ms,[e("div",ps,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ—¥æœŸ",-1)),W(e("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>$(p).date=g),type:"date",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,$(p).date]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ—¶é—´",-1)),e("div",fs,[W(e("input",{"onUpdate:modelValue":t[6]||(t[6]=g=>$(p).time=g),type:"time",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,$(p).time]])])])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¸ä¼šäºº",-1)),W(e("input",{"onUpdate:modelValue":t[7]||(t[7]=g=>$(p).attendees=g),type:"text",placeholder:"æ·»åŠ ä¸ä¼šäºº...",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,$(p).attendees]])]),e("div",ys,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-600"},"ç±»åˆ«",-1)),W(e("select",{"onUpdate:modelValue":t[8]||(t[8]=g=>$(p).category=g),class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},[...t[23]||(t[23]=[Fe('<option value="uncategorized">æœªåˆ†ç±»</option><option value="work">å·¥ä½œ</option><option value="personal">ä¸ªäºº</option><option value="meeting">ä¼šè®®</option><option value="reminder">æé†’</option>',5)])],512),[[De,$(p).category]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¼˜å…ˆçº§",-1)),W(e("select",{"onUpdate:modelValue":t[9]||(t[9]=g=>$(p).priority=g),class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},[...t[25]||(t[25]=[e("option",{value:"none"},"æ— ",-1),e("option",{value:"low"},"ä½",-1),e("option",{value:"medium"},"ä¸­",-1),e("option",{value:"high"},"é«˜",-1)])],512),[[De,$(p).priority]])])]),e("div",vs,[e("label",bs,[W(e("input",{type:"checkbox",class:"rounded","onUpdate:modelValue":t[10]||(t[10]=g=>$(p).isImportant=g)},null,512),[[pe,$(p).isImportant]]),t[27]||(t[27]=e("span",null,"æ ‡è®°ä¸ºé‡è¦",-1))]),e("label",xs,[W(e("input",{type:"checkbox",class:"rounded","onUpdate:modelValue":t[11]||(t[11]=g=>$(p).isUrgent=g)},null,512),[[pe,$(p).isUrgent]]),t[28]||(t[28]=e("span",null,"æ ‡è®°ä¸ºç´§æ€¥",-1))])]),$(p).category==="meeting"?(m(),y("div",hs,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¼šè®®è®®ç¨‹",-1)),W(e("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=g=>$(p).meetingAgenda=g),placeholder:"ä¾‹å¦‚ï¼šé¡¹ç›®è¯„å®¡ã€æ–¹æ¡ˆç¡®è®¤",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,$(p).meetingAgenda]])])])):j("",!0)])):j("",!0)]),e("div",ws,[e("button",{type:"button",onClick:t[13]||(t[13]=g=>u("close")),class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",disabled:r.saving}," å–æ¶ˆ ",8,Ds),e("button",{type:"submit",class:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:r.saving},D(r.saving?"ä¿å­˜ä¸­...":a.editingItem?"æ›´æ–°æ—¥ç¨‹":"åˆ›å»ºæ—¥ç¨‹"),9,$s)])],32))])])):j("",!0)}}}),Es={class:"min-h-screen bg-gray-50 py-8"},Ms={class:"mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8"},Os={class:"mb-6 flex flex-wrap items-center justify-between gap-3"},zs={class:"flex flex-wrap items-center gap-2"},Vs={class:"flex rounded-full bg-white p-1 text-sm shadow-sm ring-1 ring-gray-200"},Fs=["onClick"],Ps={key:0,class:"mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},ze="schedule:page-state",Bs=3600*1e3,ke="__draft__",Ks=ue({__name:"index",setup(a){const N=I(new Date),r=I(new Date),u=I("calendar"),_=I("month"),v=I([]),p=I(!1),U=I(!1),h=I(null),A=I(!1),C=I({}),w=I(!1),z=I(null),F=I(!1),d=I(null),f=I(""),L=I(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),P=[{key:"list",label:"æ¸…å•è§†å›¾"},{key:"calendar",label:"æ—¥å†è§†å›¾"},{key:"quadrant",label:"å››è±¡é™è§†å›¾"}];Te(async()=>{Je();try{const o=await rt();o?.id&&(f.value=o.id)}catch(o){console.error("Failed to load default model",o)}});const M=[{id:"1",title:"å›¢é˜Ÿä¼šè®®",description:"è®¨è®ºQ4é¡¹ç›®è¿›å±•",date:ve(0,0),time:"09:00",priority:"high",category:"meeting",completed:!1,isImportant:!0,isUrgent:!0,meetingAgenda:"é¡¹ç›®è¿›å±•ã€é˜»å¡ç‚¹ã€ä¸‹å‘¨è®¡åˆ’",attendees:"äº§å“ã€ç ”å‘ã€æµ‹è¯•"},{id:"2",title:"AIé¡¹ç›®è¯„å®¡",description:"è¯„ä¼°æ–°AIåŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆ",date:ve(0,0),time:"14:30",priority:"high",category:"work",completed:!1,isImportant:!0,isUrgent:!1},{id:"3",title:"å¥èº«è®­ç»ƒ",description:"è·‘æ­¥30åˆ†é’Ÿ + åŠ›é‡è®­ç»ƒ",date:ve(0,1),time:"07:00",priority:"medium",category:"personal",completed:!0,isImportant:!1,isUrgent:!1},{id:"4",title:"å®¢æˆ·ç”µè¯",description:"ä¸å¼ æ€»è®¨è®ºåˆä½œç»†èŠ‚",date:ve(0,1),time:"10:00",priority:"high",category:"work",completed:!1,isImportant:!0,isUrgent:!0},{id:"5",title:"è¯ç‰©æé†’",description:"è®°å¾—æœç”¨ç»´ç”Ÿç´ ",date:ve(0,2),time:"08:00",priority:"low",category:"reminder",completed:!1,isImportant:!1,isUrgent:!1}],q=o=>{if(!(!o||o==="uncategorized"))return o},Q=o=>o||void 0,i=(o,s)=>{const b=o||oe(new Date),x=s&&s.length>=4?s:"00:00",V=new Date(`${b}T${x}`);return Number.isNaN(V.getTime())?(console.warn("Invalid date/time detected, falling back to now",{date:b,time:x}),new Date):V},l=(o,s)=>{const x=(()=>{const fe=[s?.startDateTime,o.startDateTime];for(const ae of fe){if(!ae)continue;const ye=new Date(ae);if(!Number.isNaN(ye.getTime()))return ye}return i(o.date,o.time)})(),B=(()=>{const fe=[s?.endDateTime,o.endDateTime];for(const ae of fe){if(!ae)continue;const ye=new Date(ae);if(!Number.isNaN(ye.getTime()))return ye}if(o.endTime){const ae=new Date(`${o.date}T${o.endTime}`);if(!Number.isNaN(ae.getTime()))return ae}return new Date(x.getTime()+Bs)})(),E=[o.description,o.meetingAgenda].map(fe=>fe?.trim()).filter(Boolean).join(`
`),ce=o.attendees?.trim(),ee={...s?.metadata??{},completed:o.completed};return{title:o.title,description:E||void 0,startTime:x.toISOString(),endTime:B.toISOString(),attendees:ce||void 0,category:q(o.category),priority:Q(o.priority),isImportant:o.isImportant,isUrgent:o.isUrgent,timezone:s?.timezone||L.value,metadata:ee}},k=o=>{const s=o.data,b=s.startTime?new Date(s.startTime):new Date;s.endTime&&new Date(s.endTime);const x=oe(b),V=globalThis.crypto?.randomUUID?.()!==void 0?globalThis.crypto.randomUUID():`${Date.now()}`;return{id:`${ke}${V}`,title:s.title||o.summary,description:s.description||o.summary,date:x,time:te(s.startTime)||"09:00",endTime:te(s.endTime),startDateTime:s.startTime,endDateTime:s.endTime,priority:s.priority||"none",category:s.category||"uncategorized",completed:s.completed??!1,isImportant:s.isImportant,isUrgent:s.isUrgent,meetingAgenda:s.description,attendees:s.attendees,timezone:s.timezone||L.value,metadata:s.metadata}},c=async o=>{w.value=!0,z.value=null;try{const{items:s}=await at({start:o.start.toISOString(),end:o.end.toISOString()}),b=s.map(E=>X(E)),x=new Map,V=o.start.getTime(),B=o.end.getTime();v.value.forEach(E=>{const ee=be(E.date).getTime();(ee<V||ee>B)&&x.set(E.id,E)}),b.forEach(E=>x.set(E.id,E)),v.value=Array.from(x.values())}catch(s){const b=s instanceof Error?s:new Error(String(s));console.warn("Task API load failed, using mock data. Error:",b),z.value=b.message||"Failed to fetch tasks";const x=new Map;M.forEach(E=>x.set(E.id,E));const V=o.start.getTime(),B=o.end.getTime();v.value.forEach(E=>{const ee=be(E.date).getTime();(ee<V||ee>B)&&x.set(E.id,E)}),v.value=Array.from(x.values())}finally{w.value=!1}},n=async o=>{if(!F.value){F.value=!0;try{const s=l(o,h.value),b=h.value?.id.startsWith(ke)??!1;let x;h.value&&!b?x=await Ee(h.value.id,s):x=await it(s),re(X(x)),p.value=!1,h.value=null,A.value=!1}catch(s){const b=s instanceof Error?s:new Error(String(s));console.error("Failed to save schedule",b),z.value=b.message||"ä¿å­˜æ—¥ç¨‹å¤±è´¥"}finally{F.value=!1}}},t=async o=>{d.value=o;try{await dt(o),v.value=v.value.filter(s=>s.id!==o),h.value&&h.value.id===o&&(h.value=null,p.value=!1,A.value=!1)}catch(s){const b=s instanceof Error?s:new Error(String(s));console.error("Failed to delete schedule",b),z.value=b.message||"åˆ é™¤æ—¥ç¨‹å¤±è´¥"}finally{d.value===o&&(d.value=null)}},S=o=>{const s=k(o);A.value=!1,h.value=s,p.value=!0,U.value=!1},g=o=>{const{id:s,...b}=o;return l(b,o)},G=async(o,s,b="æ›´æ–°æ—¥ç¨‹çŠ¶æ€å¤±è´¥")=>{const x={...o};if(Object.assign(o,s),!o.id.startsWith(ke))try{const V=g(o),B=await Ee(o.id,V);re(X(B)),z.value=null}catch(V){Object.assign(o,x);const B=V instanceof Error?V:new Error(String(V));console.error("Failed to update schedule",B),z.value=B.message||b}},T=o=>{const s=v.value.find(b=>b.id===o);s&&G(s,{completed:!s.completed})},R=o=>{const s=v.value.find(b=>b.id===o);s&&G(s,{isImportant:!s.isImportant})},ne=o=>{const s=v.value.find(b=>b.id===o);s&&G(s,{isUrgent:!s.isUrgent})},le=o=>{const s=v.value.find(b=>b.id===o.id);s&&G(s,{title:o.title},"æ›´æ–°æ—¥ç¨‹æ ‡é¢˜å¤±è´¥")},te=o=>{if(!o)return"00:00";const s=new Date(o);return Number.isNaN(s.getTime())?o.slice(11,16)||o:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},X=o=>{const s=B=>{if(!B)return null;const E=new Date(B);return Number.isNaN(E.getTime())?null:E},b=s(o.startTime)??new Date,x=s(o.endTime),V=typeof o.completed=="boolean"?o.completed:!!o.metadata?.completed;return{id:o.id,title:o.title,description:o.description??"",date:oe(b),time:te(o.startTime),endTime:te(o.endTime??x?.toISOString()),startDateTime:s(o.startTime)?.toISOString(),endDateTime:x?.toISOString(),priority:o.priority,category:o.category,completed:V,isImportant:o.isImportant,isUrgent:o.isUrgent,meetingAgenda:o.description,attendees:o.attendees,timezone:o.timezone,metadata:o.metadata}},re=o=>{const s=v.value.findIndex(b=>b.id===o.id);s===-1?v.value.push(o):v.value[s]=o},je=o=>{const s=new Date(o),b=s.getDay(),x=b===0?-6:1-b;return s.setDate(s.getDate()+x),s.setHours(0,0,0,0),s},Le=o=>{const s=o.getFullYear(),b=o.getMonth(),x=new Date(s,b,1),V=new Date(x),B=(x.getDay()+6)%7;V.setDate(V.getDate()-B);const E=[];for(let ce=0;ce<42;ce++){const ee=new Date(V);ee.setDate(V.getDate()+ce),E.push(ee)}return E},Re=H(()=>Le(N.value)),We=H(()=>{if(_.value==="day"){const B=new Date(r.value);B.setHours(0,0,0,0);const E=new Date(r.value);return E.setHours(23,59,59,999),{start:B,end:E}}if(_.value==="week"){const B=je(r.value),E=new Date(B);return E.setDate(B.getDate()+6),E.setHours(23,59,59,999),{start:B,end:E}}const o=Re.value;if(!o.length)return null;const s=o[0],b=o[o.length-1];if(!s||!b)return null;const x=new Date(s);x.setHours(0,0,0,0);const V=new Date(b);return V.setHours(23,59,59,999),{start:x,end:V}});se(We,o=>{o&&c(o)},{immediate:!0});const $e=o=>{A.value=!1,h.value=o,p.value=!0},Se=o=>{A.value=o,h.value=null,p.value=!0},he=()=>Se(!1),we=()=>Se(!0),Ce=o=>{r.value=o,N.value=new Date(o)},qe=o=>{N.value=o},Ge=o=>{C.value[oe(r.value)]=o},Ke=o=>{re(X(o))},Qe=o=>{re(X(o))},He=o=>{v.value=v.value.filter(s=>s.id!==o)},Ye=o=>{o.forEach(s=>re(X(s)))},Je=()=>{if(!(typeof window>"u"))try{const o=window.localStorage.getItem(ze);if(!o)return;const s=JSON.parse(o);if(s.activeView&&(u.value=s.activeView),s.calendarViewMode&&(_.value=s.calendarViewMode),s.selectedDate){const b=new Date(s.selectedDate);Number.isNaN(b.getTime())||(r.value=b,N.value=new Date(b))}if(s.currentDate){const b=new Date(s.currentDate);Number.isNaN(b.getTime())||(N.value=b)}s.dailyGoals&&(C.value=s.dailyGoals)}catch(o){console.warn("Failed to restore schedule page state",o)}};return se([u,_,r,N,C],()=>{if(typeof window>"u")return;const o={activeView:u.value,calendarViewMode:_.value,selectedDate:r.value.toISOString(),currentDate:N.value.toISOString(),dailyGoals:C.value};window.localStorage.setItem(ze,JSON.stringify(o))},{deep:!0}),(o,s)=>{const b=Vt;return m(),y("div",Es,[e("div",Ms,[e("div",Os,[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-gray-900"},"æ—¥ç¨‹ç®¡ç†")],-1)),e("div",zs,[e("button",{onClick:s[0]||(s[0]=x=>he()),class:"rounded-full bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-blue-700"}," æ–°å»ºæ—¥ç¨‹ "),e("button",{onClick:s[1]||(s[1]=x=>we()),class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:border-blue-200 hover:text-blue-700"}," AI å†™å¾…åŠ "),e("div",Vs,[(m(),y(Y,null,J(P,x=>e("button",{key:x.key,onClick:V=>u.value=x.key,class:K(["rounded-full px-4 py-1.5 transition",u.value===x.key?"bg-blue-600 text-white shadow":"text-gray-600 hover:text-blue-700"])},D(x.label),11,Fs)),64))])])]),z.value?(m(),y("div",Ps," åŠ è½½æ—¥ç¨‹å¤±è´¥ï¼š"+D(z.value),1)):j("",!0),u.value==="list"?(m(),ge(Ue,{key:1,"selected-date":r.value,"schedule-items":v.value,"deleting-id":d.value,onToggleComplete:T,onToggleImportant:R,onToggleUrgent:ne,onUpdateTitle:le,onEdit:$e,onDelete:t,onCreate:s[2]||(s[2]=x=>he()),onOpenAi:s[3]||(s[3]=x=>we())},null,8,["selected-date","schedule-items","deleting-id"])):u.value==="calendar"?(m(),ge(Wo,{key:2,"current-date":N.value,"selected-date":r.value,"schedule-items":v.value,mode:_.value,loading:w.value,"deleting-id":d.value,"onUpdate:selectedDate":Ce,"onUpdate:currentDate":qe,onChangeMode:s[4]||(s[4]=x=>_.value=x),onCreate:s[5]||(s[5]=x=>{Ce(x),he()}),onEdit:$e,onOpenAi:s[6]||(s[6]=x=>we()),onToggleComplete:T,onToggleImportant:R,onToggleUrgent:ne,onDelete:t,onUpdateTitle:le},null,8,["current-date","selected-date","schedule-items","mode","loading","deleting-id"])):(m(),ge(os,{key:3,"selected-date":r.value,"schedule-items":v.value,"deleting-id":d.value,"daily-goal":C.value[$(oe)(r.value)]||"","onUpdate:dailyGoal":Ge,onToggleComplete:T,onToggleImportant:R,onToggleUrgent:ne,onUpdateTitle:le,onEdit:$e,onDelete:t,onCreate:s[7]||(s[7]=x=>he()),onOpenAi:s[8]||(s[8]=x=>we())},null,8,["selected-date","schedule-items","deleting-id","daily-goal"]))]),O(b,{open:U.value,"onUpdate:open":s[9]||(s[9]=x=>U.value=x),"model-id":f.value||void 0,timezone:L.value,onEventCreated:Ke,onEventUpdated:Qe,onEventDeleted:He,onQueryResult:Ye,onEditProposal:S},null,8,["open","model-id","timezone"]),O(Ns,{isOpen:p.value,editingItem:h.value,selectedDate:r.value,saving:F.value,startWithAi:A.value,modelId:f.value||void 0,onClose:s[10]||(s[10]=x=>{p.value=!1,h.value=null,A.value=!1}),onSave:n},null,8,["isOpen","editingItem","selectedDate","saving","startWithAi","modelId"])])}}});export{Ks as default};
